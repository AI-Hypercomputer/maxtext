[{'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#load_balancing_loss_func',
  'comp_name': 'load_balancing_loss_func',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/cache_utils.py#CacheLayerMixin',
  'comp_name': 'CacheLayerMixin',
  'filepath': 'transformers/cache_utils.py'},
 {'Dependencies': ['transformers/cache_utils.py#CacheLayerMixin'],
  'JaxDependencies': {},
  'comp_id': 'transformers/cache_utils.py#Cache',
  'comp_name': 'Cache',
  'filepath': 'transformers/cache_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRMSNorm',
  'comp_name': 'Qwen3MoeRMSNorm',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#_is_torch_greater_or_equal_than_2_6',
  'comp_name': '_is_torch_greater_or_equal_than_2_6',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#and_masks',
  'comp_name': 'and_masks',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#causal_mask_function',
  'comp_name': 'causal_mask_function',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#or_masks',
  'comp_name': 'or_masks',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#packed_sequence_mask_function',
  'comp_name': 'packed_sequence_mask_function',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#dynamic_rope_update',
  'comp_name': 'dynamic_rope_update',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#EmbeddingAccessMixin',
  'comp_name': 'EmbeddingAccessMixin',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#SpecificPreTrainedModelType',
  'comp_name': 'SpecificPreTrainedModelType',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#_get_tied_weight_keys',
  'comp_name': '_get_tied_weight_keys',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#_init_weights',
  'comp_name': '_init_weights',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#logger',
  'comp_name': 'logger',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#no_init_weights',
  'comp_name': 'no_init_weights',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#restore_default_dtype',
  'comp_name': 'restore_default_dtype',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/quantizers/quantizers_utils.py#get_module_from_name',
  'comp_name': 'get_module_from_name',
  'filepath': 'transformers/quantizers/quantizers_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#ContextManagers',
  'comp_name': 'ContextManagers',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_CAN_RECORD_REGISTRY',
  'comp_name': '_CAN_RECORD_REGISTRY',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_flash_attn_3_available',
  'comp_name': 'is_flash_attn_3_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_mlu_available',
  'comp_name': 'is_torch_mlu_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_flax_available',
  'comp_name': 'is_flax_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_torch_available',
  'comp_name': '_torch_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_available',
  'comp_name': 'is_torch_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_xpu_available',
  'comp_name': 'is_torch_xpu_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_xpu_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#_is_torch_xpu_available',
  'comp_name': '_is_torch_xpu_available',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/configuration_utils.py#PretrainedConfig',
  'comp_name': 'PretrainedConfig',
  'filepath': 'transformers/configuration_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#find_packed_sequence_indices',
  'comp_name': 'find_packed_sequence_indices',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/cache_utils.py#Cache',
                   'transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/masking_utils.py#find_packed_sequence_indices'],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#_preprocess_mask_arguments',
  'comp_name': '_preprocess_mask_arguments',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/cache_utils.py#Cache',
                   'transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/masking_utils.py#_is_torch_greater_or_equal_than_2_6',
                   'transformers/masking_utils.py#_is_torch_xpu_available',
                   'transformers/masking_utils.py#_preprocess_mask_arguments',
                   'transformers/masking_utils.py#and_masks',
                   'transformers/masking_utils.py#causal_mask_function',
                   'transformers/masking_utils.py#or_masks',
                   'transformers/masking_utils.py#packed_sequence_mask_function'],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#create_causal_mask',
  'comp_name': 'create_causal_mask',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#sliding_window_overlay',
  'comp_name': 'sliding_window_overlay',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/masking_utils.py#and_masks',
                   'transformers/masking_utils.py#causal_mask_function',
                   'transformers/masking_utils.py#sliding_window_overlay'],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#sliding_window_causal_mask_function',
  'comp_name': 'sliding_window_causal_mask_function',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/cache_utils.py#Cache',
                   'transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/masking_utils.py#_is_torch_greater_or_equal_than_2_6',
                   'transformers/masking_utils.py#_preprocess_mask_arguments',
                   'transformers/masking_utils.py#and_masks',
                   'transformers/masking_utils.py#or_masks',
                   'transformers/masking_utils.py#packed_sequence_mask_function',
                   'transformers/masking_utils.py#sliding_window_causal_mask_function'],
  'JaxDependencies': {},
  'comp_id': 'transformers/masking_utils.py#create_sliding_window_causal_mask',
  'comp_name': 'create_sliding_window_causal_mask',
  'filepath': 'transformers/masking_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_default_rope_parameters',
  'comp_name': '_compute_default_rope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_dynamic_ntk_parameters',
  'comp_name': '_compute_dynamic_ntk_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_compute_default_rope_parameters'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_linear_scaling_rope_parameters',
  'comp_name': '_compute_linear_scaling_rope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_compute_default_rope_parameters'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_llama3_parameters',
  'comp_name': '_compute_llama3_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_longrope_parameters',
  'comp_name': '_compute_longrope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_compute_yarn_parameters',
  'comp_name': '_compute_yarn_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/modeling_rope_utils.py#_compute_default_rope_parameters',
                   'transformers/modeling_rope_utils.py#_compute_dynamic_ntk_parameters',
                   'transformers/modeling_rope_utils.py#_compute_linear_scaling_rope_parameters',
                   'transformers/modeling_rope_utils.py#_compute_llama3_parameters',
                   'transformers/modeling_rope_utils.py#_compute_longrope_parameters',
                   'transformers/modeling_rope_utils.py#_compute_yarn_parameters'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#ROPE_INIT_FUNCTIONS',
  'comp_name': 'ROPE_INIT_FUNCTIONS',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_rt_detr.py#RTDetrForObjectDetectionLoss',
  'comp_name': 'RTDetrForObjectDetectionLoss',
  'filepath': 'transformers/loss/loss_rt_detr.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#ForMaskedLMLoss',
  'comp_name': 'ForMaskedLMLoss',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#ForTokenClassification',
  'comp_name': 'ForTokenClassification',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_flash_fn',
  'comp_name': '_flash_fn',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_flash_varlen_fn',
  'comp_name': '_flash_varlen_fn',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_pad_fn',
  'comp_name': '_pad_fn',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_process_flash_kwargs_fn',
  'comp_name': '_process_flash_kwargs_fn',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_unpad_fn',
  'comp_name': '_unpad_fn',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#get_parameter_device',
  'comp_name': 'get_parameter_device',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#get_parameter_dtype',
  'comp_name': 'get_parameter_dtype',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': ['transformers/modeling_utils.py#get_parameter_device',
                   'transformers/modeling_utils.py#get_parameter_dtype'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#ModuleUtilsMixin',
  'comp_name': 'ModuleUtilsMixin',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_flash_attn_2_available',
  'comp_name': 'is_flash_attn_2_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_torch_version',
  'comp_name': '_torch_version',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_torch_version',
                   'transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_flex_attn_available',
  'comp_name': 'is_torch_flex_attn_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_npu_available',
  'comp_name': 'is_torch_npu_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#rotate_half',
  'comp_name': 'rotate_half',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/models/qwen3_moe/modeling_qwen3_moe.py#rotate_half'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#apply_rotary_pos_emb',
  'comp_name': 'apply_rotary_pos_emb',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#repeat_kv',
  'comp_name': 'repeat_kv',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/models/qwen3_moe/modeling_qwen3_moe.py#repeat_kv'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#eager_attention_forward',
  'comp_name': 'eager_attention_forward',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#infer_framework_from_repr',
  'comp_name': 'infer_framework_from_repr',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_numpy_array',
  'comp_name': 'is_numpy_array',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_fx_available',
  'comp_name': 'is_torch_fx_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_torch_fx_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torch_fx_proxy',
  'comp_name': 'is_torch_fx_proxy',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_dynamic_scaling_rope_parameters',
  'comp_name': '_validate_dynamic_scaling_rope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_linear_scaling_rope_parameters',
  'comp_name': '_validate_linear_scaling_rope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#AccurateGELUActivation',
  'comp_name': 'AccurateGELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#ClassInstantier',
  'comp_name': 'ClassInstantier',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#GELUActivation',
  'comp_name': 'GELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#LaplaceActivation',
  'comp_name': 'LaplaceActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#LinearActivation',
  'comp_name': 'LinearActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#MishActivation',
  'comp_name': 'MishActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#NewGELUActivation',
  'comp_name': 'NewGELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#PytorchGELUTanh',
  'comp_name': 'PytorchGELUTanh',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#QuickGELUActivation',
  'comp_name': 'QuickGELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#ReLUSquaredActivation',
  'comp_name': 'ReLUSquaredActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#XIELUActivation',
  'comp_name': 'XIELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#_set_aux_loss',
  'comp_name': '_set_aux_loss',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#_set_aux_loss2',
  'comp_name': '_set_aux_loss2',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#_set_aux_loss',
  'comp_name': '_set_aux_loss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#fixed_cross_entropy',
  'comp_name': 'fixed_cross_entropy',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': ['transformers/loss/loss_utils.py#fixed_cross_entropy'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#ForCausalLMLoss',
  'comp_name': 'ForCausalLMLoss',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': ['transformers/loss/loss_utils.py#fixed_cross_entropy'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#ForQuestionAnsweringLoss',
  'comp_name': 'ForQuestionAnsweringLoss',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': ['transformers/loss/loss_utils.py#fixed_cross_entropy'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#ForSequenceClassificationLoss',
  'comp_name': 'ForSequenceClassificationLoss',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_hf_api_to_flash_mapping',
  'comp_name': '_hf_api_to_flash_mapping',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_process_flash_attention_kwargs',
  'comp_name': '_process_flash_attention_kwargs',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': ['transformers/modeling_flash_attention_utils.py#_hf_api_to_flash_mapping',
                   'transformers/modeling_flash_attention_utils.py#_process_flash_attention_kwargs'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_lazy_define_process_function',
  'comp_name': '_lazy_define_process_function',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_pad_input',
  'comp_name': '_pad_input',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_is_jax',
  'comp_name': '_is_jax',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/generic.py#_is_jax',
                   'transformers/utils/import_utils.py#is_flax_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_jax_tensor',
  'comp_name': 'is_jax_tensor',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_is_mlx',
  'comp_name': '_is_mlx',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_is_tensorflow',
  'comp_name': '_is_tensorflow',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_is_torch',
  'comp_name': '_is_torch',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/generic.py#_is_torch',
                   'transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_torch_tensor',
  'comp_name': 'is_torch_tensor',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_check_received_keys',
  'comp_name': '_check_received_keys',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_check_received_keys'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_default_rope_parameters',
  'comp_name': '_validate_default_rope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_check_received_keys'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_llama3_parameters',
  'comp_name': '_validate_llama3_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#logger',
  'comp_name': 'logger',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_check_received_keys',
                   'transformers/modeling_rope_utils.py#logger'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_longrope_parameters',
  'comp_name': '_validate_longrope_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#_check_received_keys'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#_validate_yarn_parameters',
  'comp_name': '_validate_yarn_parameters',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/modeling_rope_utils.py#_validate_default_rope_parameters',
                   'transformers/modeling_rope_utils.py#_validate_dynamic_scaling_rope_parameters',
                   'transformers/modeling_rope_utils.py#_validate_linear_scaling_rope_parameters',
                   'transformers/modeling_rope_utils.py#_validate_llama3_parameters',
                   'transformers/modeling_rope_utils.py#_validate_longrope_parameters',
                   'transformers/modeling_rope_utils.py#_validate_yarn_parameters'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#ROPE_VALIDATION_FUNCTIONS',
  'comp_name': 'ROPE_VALIDATION_FUNCTIONS',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#ROPE_VALIDATION_FUNCTIONS'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_rope_utils.py#rope_config_validation',
  'comp_name': 'rope_config_validation',
  'filepath': 'transformers/modeling_rope_utils.py'},
 {'Dependencies': ['transformers/integrations/hub_kernels.py#use_kernel_forward_from_hub'],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#FastGELUActivation',
  'comp_name': 'FastGELUActivation',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#sigmoid_focal_loss',
  'comp_name': 'sigmoid_focal_loss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#dice_loss',
  'comp_name': 'dice_loss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_accelerate_available',
  'comp_name': 'is_accelerate_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_grounding_dino.py#sigmoid_focal_loss',
  'comp_name': 'sigmoid_focal_loss',
  'filepath': 'transformers/loss/loss_grounding_dino.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_index_first_axis',
  'comp_name': '_index_first_axis',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': ['transformers/modeling_flash_attention_utils.py#_index_first_axis'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_unpad_input',
  'comp_name': '_unpad_input',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': ['transformers/modeling_flash_attention_utils.py#_pad_input',
                   'transformers/modeling_flash_attention_utils.py#_unpad_input',
                   'transformers/utils/import_utils.py#is_flash_attn_2_available',
                   'transformers/utils/import_utils.py#is_flash_attn_3_available',
                   'transformers/utils/import_utils.py#is_torch_npu_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#_lazy_imports',
  'comp_name': '_lazy_imports',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': ['transformers/modeling_flash_attention_utils.py#_flash_fn',
                   'transformers/modeling_flash_attention_utils.py#_flash_varlen_fn',
                   'transformers/modeling_flash_attention_utils.py#_lazy_define_process_function',
                   'transformers/modeling_flash_attention_utils.py#_lazy_imports',
                   'transformers/modeling_flash_attention_utils.py#_pad_fn',
                   'transformers/modeling_flash_attention_utils.py#_process_flash_kwargs_fn',
                   'transformers/modeling_flash_attention_utils.py#_unpad_fn'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_flash_attention_utils.py#lazy_import_flash_attention',
  'comp_name': 'lazy_import_flash_attention',
  'filepath': 'transformers/modeling_flash_attention_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#ACCELERATE_IMPORT_ERROR',
  'comp_name': 'ACCELERATE_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#AV_IMPORT_ERROR',
  'comp_name': 'AV_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#BS4_IMPORT_ERROR',
  'comp_name': 'BS4_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#CCL_IMPORT_ERROR',
  'comp_name': 'CCL_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#CV2_IMPORT_ERROR',
  'comp_name': 'CV2_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#CYTHON_IMPORT_ERROR',
  'comp_name': 'CYTHON_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#DATASETS_IMPORT_ERROR',
  'comp_name': 'DATASETS_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#DECORD_IMPORT_ERROR',
  'comp_name': 'DECORD_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#DETECTRON2_IMPORT_ERROR',
  'comp_name': 'DETECTRON2_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#FASTAPI_IMPORT_ERROR',
  'comp_name': 'FASTAPI_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#FLAX_IMPORT_ERROR',
  'comp_name': 'FLAX_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#FTFY_IMPORT_ERROR',
  'comp_name': 'FTFY_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#G2P_EN_IMPORT_ERROR',
  'comp_name': 'G2P_EN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#JINJA_IMPORT_ERROR',
  'comp_name': 'JINJA_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#KERAS_NLP_IMPORT_ERROR',
  'comp_name': 'KERAS_NLP_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#LEVENSHTEIN_IMPORT_ERROR',
  'comp_name': 'LEVENSHTEIN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#LIBROSA_IMPORT_ERROR',
  'comp_name': 'LIBROSA_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#MISTRAL_COMMON_IMPORT_ERROR',
  'comp_name': 'MISTRAL_COMMON_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#NATTEN_IMPORT_ERROR',
  'comp_name': 'NATTEN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#NLTK_IMPORT_ERROR',
  'comp_name': 'NLTK_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#OPENAI_IMPORT_ERROR',
  'comp_name': 'OPENAI_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PANDAS_IMPORT_ERROR',
  'comp_name': 'PANDAS_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PEFT_IMPORT_ERROR',
  'comp_name': 'PEFT_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PHONEMIZER_IMPORT_ERROR',
  'comp_name': 'PHONEMIZER_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PRETTY_MIDI_IMPORT_ERROR',
  'comp_name': 'PRETTY_MIDI_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PROTOBUF_IMPORT_ERROR',
  'comp_name': 'PROTOBUF_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYCTCDECODE_IMPORT_ERROR',
  'comp_name': 'PYCTCDECODE_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYDANTIC_IMPORT_ERROR',
  'comp_name': 'PYDANTIC_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYTESSERACT_IMPORT_ERROR',
  'comp_name': 'PYTESSERACT_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYTORCH_IMPORT_ERROR',
  'comp_name': 'PYTORCH_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYTORCH_QUANTIZATION_IMPORT_ERROR',
  'comp_name': 'PYTORCH_QUANTIZATION_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#RICH_IMPORT_ERROR',
  'comp_name': 'RICH_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#RJIEBA_IMPORT_ERROR',
  'comp_name': 'RJIEBA_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#SACREMOSES_IMPORT_ERROR',
  'comp_name': 'SACREMOSES_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#SCIPY_IMPORT_ERROR',
  'comp_name': 'SCIPY_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#SENTENCEPIECE_IMPORT_ERROR',
  'comp_name': 'SENTENCEPIECE_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#SKLEARN_IMPORT_ERROR',
  'comp_name': 'SKLEARN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#SPEECH_IMPORT_ERROR',
  'comp_name': 'SPEECH_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TENSORFLOW_IMPORT_ERROR',
  'comp_name': 'TENSORFLOW_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TENSORFLOW_PROBABILITY_IMPORT_ERROR',
  'comp_name': 'TENSORFLOW_PROBABILITY_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TENSORFLOW_TEXT_IMPORT_ERROR',
  'comp_name': 'TENSORFLOW_TEXT_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TIMM_IMPORT_ERROR',
  'comp_name': 'TIMM_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TOKENIZERS_IMPORT_ERROR',
  'comp_name': 'TOKENIZERS_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TORCHAUDIO_IMPORT_ERROR',
  'comp_name': 'TORCHAUDIO_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TORCHCODEC_IMPORT_ERROR',
  'comp_name': 'TORCHCODEC_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TORCHVISION_IMPORT_ERROR',
  'comp_name': 'TORCHVISION_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#UROMAN_IMPORT_ERROR',
  'comp_name': 'UROMAN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#UVICORN_IMPORT_ERROR',
  'comp_name': 'UVICORN_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#VISION_IMPORT_ERROR',
  'comp_name': 'VISION_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#YT_DLP_IMPORT_ERROR',
  'comp_name': 'YT_DLP_IMPORT_ERROR',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_bs4_available',
  'comp_name': 'is_bs4_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_cv2_available',
  'comp_name': 'is_cv2_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_cython_available',
  'comp_name': 'is_cython_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_datasets_available',
  'comp_name': 'is_datasets_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_decord_available',
  'comp_name': 'is_decord_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_detectron2_available',
  'comp_name': 'is_detectron2_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_essentia_available',
  'comp_name': 'is_essentia_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_faiss_available',
  'comp_name': 'is_faiss_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_fastapi_available',
  'comp_name': 'is_fastapi_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_ftfy_available',
  'comp_name': 'is_ftfy_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_g2p_en_available',
  'comp_name': 'is_g2p_en_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_levenshtein_available',
  'comp_name': 'is_levenshtein_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_librosa_available',
  'comp_name': 'is_librosa_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_natten_available',
  'comp_name': 'is_natten_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_nltk_available',
  'comp_name': 'is_nltk_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_openai_available',
  'comp_name': 'is_openai_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pandas_available',
  'comp_name': 'is_pandas_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_peft_available',
  'comp_name': 'is_peft_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_protobuf_available',
  'comp_name': 'is_protobuf_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pyctcdecode_available',
  'comp_name': 'is_pyctcdecode_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pydantic_available',
  'comp_name': 'is_pydantic_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pytesseract_available',
  'comp_name': 'is_pytesseract_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pytorch_quantization_available',
  'comp_name': 'is_pytorch_quantization_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_rich_available',
  'comp_name': 'is_rich_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_sacremoses_available',
  'comp_name': 'is_sacremoses_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_sentencepiece_available',
  'comp_name': 'is_sentencepiece_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_sklearn_available',
  'comp_name': 'is_sklearn_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_tensorflow_probability_available',
  'comp_name': 'is_tensorflow_probability_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_timm_available',
  'comp_name': 'is_timm_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_tokenizers_available',
  'comp_name': 'is_tokenizers_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torchaudio_available',
  'comp_name': 'is_torchaudio_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torchvision_available',
  'comp_name': 'is_torchvision_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_uroman_available',
  'comp_name': 'is_uroman_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_uvicorn_available',
  'comp_name': 'is_uvicorn_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_vision_available',
  'comp_name': 'is_vision_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_yt_dlp_available',
  'comp_name': 'is_yt_dlp_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#VersionComparison',
  'comp_name': 'VersionComparison',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#split_package_version',
  'comp_name': 'split_package_version',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/modeling_rope_utils.py#rope_config_validation'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig',
  'comp_name': 'Qwen3MoeConfig',
  'filepath': 'transformers/models/qwen3_moe/configuration_qwen3_moe.py'},
 {'Dependencies': ['transformers/modeling_utils.py#ALL_ATTENTION_FUNCTIONS',
                   'transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRMSNorm',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#apply_rotary_pos_emb',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#eager_attention_forward'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeAttention',
  'comp_name': 'Qwen3MoeAttention',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/activations.py#AccurateGELUActivation',
                   'transformers/activations.py#ClassInstantier',
                   'transformers/activations.py#FastGELUActivation',
                   'transformers/activations.py#GELUActivation',
                   'transformers/activations.py#LaplaceActivation',
                   'transformers/activations.py#LinearActivation',
                   'transformers/activations.py#MishActivation',
                   'transformers/activations.py#NewGELUActivation',
                   'transformers/activations.py#PytorchGELUTanh',
                   'transformers/activations.py#QuickGELUActivation',
                   'transformers/activations.py#ReLUSquaredActivation',
                   'transformers/activations.py#XIELUActivation'],
  'JaxDependencies': {},
  'comp_id': 'transformers/activations.py#ACT2FN',
  'comp_name': 'ACT2FN',
  'filepath': 'transformers/activations.py'},
 {'Dependencies': ['transformers/activations.py#ACT2FN'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeMLP',
  'comp_name': 'Qwen3MoeMLP',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeMLP'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeSparseMoeBlock',
  'comp_name': 'Qwen3MoeSparseMoeBlock',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeAttention',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeMLP',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRMSNorm',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeSparseMoeBlock'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeDecoderLayer',
  'comp_name': 'Qwen3MoeDecoderLayer',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/modeling_rope_utils.py#ROPE_INIT_FUNCTIONS',
                   'transformers/modeling_rope_utils.py#dynamic_rope_update',
                   'transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRotaryEmbedding',
  'comp_name': 'Qwen3MoeRotaryEmbedding',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_mlx_available',
  'comp_name': '_mlx_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_mlx_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_mlx_available',
  'comp_name': 'is_mlx_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/generic.py#_is_mlx',
                   'transformers/utils/import_utils.py#is_mlx_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_mlx_array',
  'comp_name': 'is_mlx_array',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_tf_available',
  'comp_name': '_tf_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/image_transforms.py#_center_to_corners_format_numpy',
  'comp_name': '_center_to_corners_format_numpy',
  'filepath': 'transformers/image_transforms.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/image_transforms.py#_center_to_corners_format_tf',
  'comp_name': '_center_to_corners_format_tf',
  'filepath': 'transformers/image_transforms.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/image_transforms.py#_center_to_corners_format_torch',
  'comp_name': '_center_to_corners_format_torch',
  'filepath': 'transformers/image_transforms.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#PYTORCH_IMPORT_ERROR_WITH_TF',
  'comp_name': 'PYTORCH_IMPORT_ERROR_WITH_TF',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#TF_IMPORT_ERROR_WITH_PYTORCH',
  'comp_name': 'TF_IMPORT_ERROR_WITH_PYTORCH',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#NestedTensor',
  'comp_name': 'NestedTensor',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#_max_by_axis',
  'comp_name': '_max_by_axis',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_av_available',
  'comp_name': '_av_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_av_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_av_available',
  'comp_name': 'is_av_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_is_ccl_available',
  'comp_name': '_is_ccl_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_is_ccl_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_ccl_available',
  'comp_name': 'is_ccl_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_jinja_available',
  'comp_name': '_jinja_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_jinja_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_jinja_available',
  'comp_name': 'is_jinja_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_keras_nlp_available',
  'comp_name': '_keras_nlp_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_mistral_common_available',
  'comp_name': '_mistral_common_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_mistral_common_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_mistral_common_available',
  'comp_name': 'is_mistral_common_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_phonemizer_available',
  'comp_name': '_phonemizer_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_phonemizer_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_phonemizer_available',
  'comp_name': 'is_phonemizer_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_pretty_midi_available',
  'comp_name': '_pretty_midi_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_pretty_midi_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_pretty_midi_available',
  'comp_name': 'is_pretty_midi_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_rjieba_available',
  'comp_name': '_rjieba_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_rjieba_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_rjieba_available',
  'comp_name': 'is_rjieba_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_scipy_available',
  'comp_name': '_scipy_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_scipy_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_scipy_available',
  'comp_name': 'is_scipy_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_torchaudio_available',
  'comp_name': '_torchaudio_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_torchaudio_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_speech_available',
  'comp_name': 'is_speech_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_tensorflow_text_available',
  'comp_name': '_tensorflow_text_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_tf_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_tf_available',
  'comp_name': 'is_tf_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#_torchcodec_available',
  'comp_name': '_torchcodec_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_torchcodec_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_torchcodec_available',
  'comp_name': 'is_torchcodec_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/generic.py#_is_tensorflow',
                   'transformers/utils/import_utils.py#is_tf_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_tf_tensor',
  'comp_name': 'is_tf_tensor',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/generic.py#infer_framework_from_repr',
                   'transformers/utils/generic.py#is_jax_tensor',
                   'transformers/utils/generic.py#is_mlx_array',
                   'transformers/utils/generic.py#is_numpy_array',
                   'transformers/utils/generic.py#is_tf_tensor',
                   'transformers/utils/generic.py#is_torch_tensor'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#_get_frameworks_and_test_func',
  'comp_name': '_get_frameworks_and_test_func',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#ExplicitEnum',
  'comp_name': 'ExplicitEnum',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/generic.py#ExplicitEnum'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#TensorType',
  'comp_name': 'TensorType',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/image_transforms.py#_center_to_corners_format_numpy',
                   'transformers/image_transforms.py#_center_to_corners_format_tf',
                   'transformers/image_transforms.py#_center_to_corners_format_torch',
                   'transformers/utils/generic.py#TensorType',
                   'transformers/utils/generic.py#is_tf_tensor',
                   'transformers/utils/generic.py#is_torch_tensor'],
  'JaxDependencies': {},
  'comp_id': 'transformers/image_transforms.py#center_to_corners_format',
  'comp_name': 'center_to_corners_format',
  'filepath': 'transformers/image_transforms.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#weighting_function',
  'comp_name': 'weighting_function',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': ['transformers/loss/loss_d_fine.py#weighting_function'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#translate_gt',
  'comp_name': 'translate_gt',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': ['transformers/loss/loss_d_fine.py#translate_gt'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#bbox2distance',
  'comp_name': 'bbox2distance',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': [],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#_upcast',
  'comp_name': '_upcast',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#_upcast'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#box_area',
  'comp_name': 'box_area',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#box_area'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#box_iou',
  'comp_name': 'box_iou',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#box_iou'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#generalized_box_iou',
  'comp_name': 'generalized_box_iou',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#NestedTensor',
                   'transformers/loss/loss_for_object_detection.py#_max_by_axis'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#nested_tensor_from_tensor_list',
  'comp_name': 'nested_tensor_from_tensor_list',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#dice_loss',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou',
                   'transformers/loss/loss_for_object_detection.py#nested_tensor_from_tensor_list',
                   'transformers/loss/loss_for_object_detection.py#sigmoid_focal_loss',
                   'transformers/utils/import_utils.py#is_accelerate_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#ImageLoss',
  'comp_name': 'ImageLoss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#ImageLoss',
                   'transformers/loss/loss_for_object_detection.py#sigmoid_focal_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_deformable_detr.py#DeformableDetrImageLoss',
  'comp_name': 'DeformableDetrImageLoss',
  'filepath': 'transformers/loss/loss_deformable_detr.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#ImageLoss',
                   'transformers/loss/loss_grounding_dino.py#sigmoid_focal_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_grounding_dino.py#GroundingDinoImageLoss',
  'comp_name': 'GroundingDinoImageLoss',
  'filepath': 'transformers/loss/loss_grounding_dino.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#is_tf_available',
                   'transformers/utils/import_utils.py#_tensorflow_text_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_tensorflow_text_available',
  'comp_name': 'is_tensorflow_text_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/generic.py#_get_frameworks_and_test_func',
                   'transformers/utils/import_utils.py#is_flax_available',
                   'transformers/utils/import_utils.py#is_torch_fx_proxy'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#is_tensor',
  'comp_name': 'is_tensor',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/generic.py#is_tensor',
                   'transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#ModelOutput',
  'comp_name': 'ModelOutput',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/cache_utils.py#Cache',
                   'transformers/utils/generic.py#ModelOutput'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_outputs.py#MoeCausalLMOutputWithPast',
  'comp_name': 'MoeCausalLMOutputWithPast',
  'filepath': 'transformers/modeling_outputs.py'},
 {'Dependencies': ['transformers/utils/generic.py#ModelOutput'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_outputs.py#MoeModelOutputWithPast',
  'comp_name': 'MoeModelOutputWithPast',
  'filepath': 'transformers/modeling_outputs.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#_keras_nlp_available',
                   'transformers/utils/import_utils.py#is_tensorflow_text_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#is_keras_nlp_available',
  'comp_name': 'is_keras_nlp_available',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#ACCELERATE_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#AV_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#BS4_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#CCL_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#CV2_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#CYTHON_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#DATASETS_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#DECORD_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#DETECTRON2_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#ESSENTIA_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#FAISS_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#FASTAPI_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#FLAX_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#FTFY_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#G2P_EN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#JINJA_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#KERAS_NLP_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#LEVENSHTEIN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#LIBROSA_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#MISTRAL_COMMON_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#NATTEN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#NLTK_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#OPENAI_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PANDAS_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PEFT_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PHONEMIZER_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PRETTY_MIDI_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PROTOBUF_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PYCTCDECODE_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PYDANTIC_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PYTESSERACT_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PYTORCH_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#PYTORCH_QUANTIZATION_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#RICH_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#RJIEBA_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#SACREMOSES_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#SCIPY_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#SENTENCEPIECE_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#SKLEARN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#SPEECH_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TENSORFLOW_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TENSORFLOW_PROBABILITY_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TENSORFLOW_TEXT_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TIMM_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TOKENIZERS_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TORCHAUDIO_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TORCHCODEC_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#TORCHVISION_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#UROMAN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#UVICORN_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#VISION_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#YT_DLP_IMPORT_ERROR',
                   'transformers/utils/import_utils.py#is_accelerate_available',
                   'transformers/utils/import_utils.py#is_av_available',
                   'transformers/utils/import_utils.py#is_bs4_available',
                   'transformers/utils/import_utils.py#is_ccl_available',
                   'transformers/utils/import_utils.py#is_cv2_available',
                   'transformers/utils/import_utils.py#is_cython_available',
                   'transformers/utils/import_utils.py#is_datasets_available',
                   'transformers/utils/import_utils.py#is_decord_available',
                   'transformers/utils/import_utils.py#is_detectron2_available',
                   'transformers/utils/import_utils.py#is_essentia_available',
                   'transformers/utils/import_utils.py#is_faiss_available',
                   'transformers/utils/import_utils.py#is_fastapi_available',
                   'transformers/utils/import_utils.py#is_flax_available',
                   'transformers/utils/import_utils.py#is_ftfy_available',
                   'transformers/utils/import_utils.py#is_g2p_en_available',
                   'transformers/utils/import_utils.py#is_jinja_available',
                   'transformers/utils/import_utils.py#is_keras_nlp_available',
                   'transformers/utils/import_utils.py#is_levenshtein_available',
                   'transformers/utils/import_utils.py#is_librosa_available',
                   'transformers/utils/import_utils.py#is_mistral_common_available',
                   'transformers/utils/import_utils.py#is_natten_available',
                   'transformers/utils/import_utils.py#is_nltk_available',
                   'transformers/utils/import_utils.py#is_openai_available',
                   'transformers/utils/import_utils.py#is_pandas_available',
                   'transformers/utils/import_utils.py#is_peft_available',
                   'transformers/utils/import_utils.py#is_phonemizer_available',
                   'transformers/utils/import_utils.py#is_pretty_midi_available',
                   'transformers/utils/import_utils.py#is_protobuf_available',
                   'transformers/utils/import_utils.py#is_pyctcdecode_available',
                   'transformers/utils/import_utils.py#is_pydantic_available',
                   'transformers/utils/import_utils.py#is_pytesseract_available',
                   'transformers/utils/import_utils.py#is_pytorch_quantization_available',
                   'transformers/utils/import_utils.py#is_rich_available',
                   'transformers/utils/import_utils.py#is_rjieba_available',
                   'transformers/utils/import_utils.py#is_sacremoses_available',
                   'transformers/utils/import_utils.py#is_scipy_available',
                   'transformers/utils/import_utils.py#is_sentencepiece_available',
                   'transformers/utils/import_utils.py#is_sklearn_available',
                   'transformers/utils/import_utils.py#is_speech_available',
                   'transformers/utils/import_utils.py#is_tensorflow_probability_available',
                   'transformers/utils/import_utils.py#is_tensorflow_text_available',
                   'transformers/utils/import_utils.py#is_tf_available',
                   'transformers/utils/import_utils.py#is_timm_available',
                   'transformers/utils/import_utils.py#is_tokenizers_available',
                   'transformers/utils/import_utils.py#is_torch_available',
                   'transformers/utils/import_utils.py#is_torchaudio_available',
                   'transformers/utils/import_utils.py#is_torchcodec_available',
                   'transformers/utils/import_utils.py#is_torchvision_available',
                   'transformers/utils/import_utils.py#is_uroman_available',
                   'transformers/utils/import_utils.py#is_uvicorn_available',
                   'transformers/utils/import_utils.py#is_vision_available',
                   'transformers/utils/import_utils.py#is_yt_dlp_available'],
  'JaxDependencies': {'transformers/utils/import_utils.py#ESSENTIA_IMPORT_ERROR': [[0.0,
                                                                                    'MaxText/layers/attention_mla.py#mla_as_linen',
                                                                                    'MaxText/layers/attention_mla.py',
                                                                                    'def '
                                                                                    'mla_as_linen(\n'
                                                                                    '    '
                                                                                    '*,\n'
                                                                                    '    '
                                                                                    'config: '
                                                                                    'Config,\n'
                                                                                    '    '
                                                                                    'num_query_heads: '
                                                                                    'int,\n'
                                                                                    '    '
                                                                                    'num_kv_heads: '
                                                                                    'int,\n'
                                                                                    '    '
                                                                                    'head_dim: '
                                                                                    'int,\n'
                                                                                    '    '
                                                                                    'max_target_length: '
                                                                                    'int,\n'
                                                                                    '    '
                                                                                    'mesh: '
                                                                                    'Mesh,\n'
                                                                                    '    '
                                                                                    'attention_kernel: '
                                                                                    'str,\n'
                                                                                    '    '
                                                                                    'inputs_q_shape: '
                                                                                    'Tuple,\n'
                                                                                    '    '
                                                                                    'inputs_kv_shape: '
                                                                                    'Tuple,\n'
                                                                                    '    '
                                                                                    'dtype: '
                                                                                    'DType '
                                                                                    '= '
                                                                                    'jnp.float32,\n'
                                                                                    '    '
                                                                                    'weight_dtype: '
                                                                                    'DType '
                                                                                    '= '
                                                                                    'jnp.float32,\n'
                                                                                    '    '
                                                                                    'max_prefill_predict_length: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '-1,\n'
                                                                                    '    '
                                                                                    'dropout_rate: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '0.0,\n'
                                                                                    '    '
                                                                                    'kernel_init: '
                                                                                    'NdInitializer '
                                                                                    '= '
                                                                                    'nd_dense_init(1.0, '
                                                                                    '"fan_in", '
                                                                                    '"normal"),\n'
                                                                                    '    '
                                                                                    'float32_qk_product: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'computes '
                                                                                    'logits '
                                                                                    'in '
                                                                                    'float32 '
                                                                                    'for '
                                                                                    'stability.\n'
                                                                                    '    '
                                                                                    'float32_logits: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'cast '
                                                                                    'logits '
                                                                                    'in '
                                                                                    'float32 '
                                                                                    'for '
                                                                                    'stability.\n'
                                                                                    '    '
                                                                                    'quant: '
                                                                                    'Optional[Quant] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '    '
                                                                                    'kv_quant: '
                                                                                    'Optional[KVQuant] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '    '
                                                                                    'attention_type: '
                                                                                    'AttentionType '
                                                                                    '= '
                                                                                    'AttentionType.GLOBAL,  '
                                                                                    '# '
                                                                                    'Default '
                                                                                    'to '
                                                                                    'global '
                                                                                    'attention\n'
                                                                                    '    '
                                                                                    'attn_logits_soft_cap: '
                                                                                    'float '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '    '
                                                                                    'sliding_window_size: '
                                                                                    'int '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '    '
                                                                                    'use_ragged_attention: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'ragged_block_size: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '256,\n'
                                                                                    '    '
                                                                                    'use_qk_norm: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'query_pre_attn_scalar: '
                                                                                    'float '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '    '
                                                                                    'use_bias_in_projections: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'Set '
                                                                                    'to '
                                                                                    'True '
                                                                                    'will '
                                                                                    'enable '
                                                                                    'bias '
                                                                                    'in '
                                                                                    'q, '
                                                                                    'k, '
                                                                                    'v, '
                                                                                    'o '
                                                                                    'projections\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Temperature '
                                                                                    'tuning '
                                                                                    'parameters '
                                                                                    'used '
                                                                                    'for '
                                                                                    'Llama4\n'
                                                                                    '    '
                                                                                    'temperature_tuning: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'temperature_tuning_scale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '0.1,\n'
                                                                                    '    '
                                                                                    'temperature_tuning_floor_scale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '8192.0,\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Shard '
                                                                                    'the '
                                                                                    'query '
                                                                                    'activation '
                                                                                    'as '
                                                                                    'the '
                                                                                    'same '
                                                                                    'as '
                                                                                    'the '
                                                                                    'key '
                                                                                    'and '
                                                                                    'value.\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'TODO: '
                                                                                    'Find '
                                                                                    'a '
                                                                                    'better '
                                                                                    'sharding '
                                                                                    'axis '
                                                                                    'name.\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'TODO: '
                                                                                    'Further '
                                                                                    'break '
                                                                                    'down '
                                                                                    'the '
                                                                                    'Training '
                                                                                    'and '
                                                                                    'Inference '
                                                                                    'axes '
                                                                                    'for '
                                                                                    'the '
                                                                                    'q, '
                                                                                    'k, '
                                                                                    'v.\n'
                                                                                    '    '
                                                                                    'prefill_query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'prefill_key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'prefill_value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'ep_query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'ep_key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'ep_value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '    '
                                                                                    'input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'EMBED),\n'
                                                                                    '    '
                                                                                    'ep_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '    '
                                                                                    'out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '    '
                                                                                    'ep_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '    '
                                                                                    'prefill_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '    '
                                                                                    'decode_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(DECODE_BATCH, '
                                                                                    'DECODE_LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '    '
                                                                                    'prefill_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '    '
                                                                                    'decode_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(DECODE_BATCH, '
                                                                                    'DECODE_LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '    '
                                                                                    'prefill_cache_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(1, '
                                                                                    '2, '
                                                                                    '0, '
                                                                                    '3),\n'
                                                                                    '    '
                                                                                    'ar_cache_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(1, '
                                                                                    '2, '
                                                                                    '0, '
                                                                                    '3),\n'
                                                                                    '    '
                                                                                    'compute_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(0, '
                                                                                    '1, '
                                                                                    '2, '
                                                                                    '3),\n'
                                                                                    '    '
                                                                                    'reshape_q: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'is_nope_layer: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'is_vision: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '    '
                                                                                    'model_mode: '
                                                                                    'str '
                                                                                    '= '
                                                                                    'MODEL_MODE_TRAIN,\n'
                                                                                    '    '
                                                                                    'q_lora_rank: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '0,\n'
                                                                                    '    '
                                                                                    'kv_lora_rank: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '512,\n'
                                                                                    '    '
                                                                                    'qk_nope_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '128,\n'
                                                                                    '    '
                                                                                    'qk_rope_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '64,\n'
                                                                                    '    '
                                                                                    'v_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '128,\n'
                                                                                    '    '
                                                                                    'max_position_embeddings: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '4096 '
                                                                                    '* '
                                                                                    '4,\n'
                                                                                    '    '
                                                                                    'original_max_position_embeddings: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '4096,\n'
                                                                                    '    '
                                                                                    'mscale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '1.0,  '
                                                                                    '# '
                                                                                    'scaling '
                                                                                    'factor '
                                                                                    'for '
                                                                                    'softmax\n'
                                                                                    '    '
                                                                                    'rope_factor: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '40.0,  '
                                                                                    '# '
                                                                                    'rotary '
                                                                                    'embedding '
                                                                                    'factor\n'
                                                                                    '    '
                                                                                    'name: '
                                                                                    'str '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '):\n'
                                                                                    '  '
                                                                                    '"""A '
                                                                                    'factory '
                                                                                    'function '
                                                                                    'to '
                                                                                    'create '
                                                                                    'an '
                                                                                    'MLA '
                                                                                    'as '
                                                                                    'a '
                                                                                    'Linen '
                                                                                    'module.\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'This '
                                                                                    'function '
                                                                                    'serves '
                                                                                    'as '
                                                                                    'a '
                                                                                    'bridge '
                                                                                    'to '
                                                                                    'use '
                                                                                    'the '
                                                                                    'NNX-based '
                                                                                    '`MLA` '
                                                                                    'within '
                                                                                    'a\n'
                                                                                    '  '
                                                                                    'Linen '
                                                                                    'model.\n'
                                                                                    '  '
                                                                                    '"""\n'
                                                                                    '  '
                                                                                    'return '
                                                                                    'nnx_wrappers.to_linen(\n'
                                                                                    '      '
                                                                                    'MLA,\n'
                                                                                    '      '
                                                                                    'config=config,\n'
                                                                                    '      '
                                                                                    'num_query_heads=num_query_heads,\n'
                                                                                    '      '
                                                                                    'num_kv_heads=num_kv_heads,\n'
                                                                                    '      '
                                                                                    'head_dim=head_dim,\n'
                                                                                    '      '
                                                                                    'max_target_length=max_target_length,\n'
                                                                                    '      '
                                                                                    'mesh=mesh,\n'
                                                                                    '      '
                                                                                    'attention_kernel=attention_kernel,\n'
                                                                                    '      '
                                                                                    'inputs_q_shape=inputs_q_shape,\n'
                                                                                    '      '
                                                                                    'inputs_kv_shape=inputs_kv_shape,\n'
                                                                                    '      '
                                                                                    'dtype=dtype,\n'
                                                                                    '      '
                                                                                    'weight_dtype=weight_dtype,\n'
                                                                                    '      '
                                                                                    'max_prefill_predict_length=max_prefill_predict_length,\n'
                                                                                    '      '
                                                                                    'dropout_rate=dropout_rate,\n'
                                                                                    '      '
                                                                                    'kernel_init=kernel_init,\n'
                                                                                    '      '
                                                                                    'float32_qk_product=float32_qk_product,\n'
                                                                                    '      '
                                                                                    'float32_logits=float32_logits,\n'
                                                                                    '      '
                                                                                    'quant=quant,\n'
                                                                                    '      '
                                                                                    'kv_quant=kv_quant,\n'
                                                                                    '      '
                                                                                    'attention_type=attention_type,\n'
                                                                                    '      '
                                                                                    'attn_logits_soft_cap=attn_logits_soft_cap,\n'
                                                                                    '      '
                                                                                    'sliding_window_size=sliding_window_size,\n'
                                                                                    '      '
                                                                                    'use_ragged_attention=use_ragged_attention,\n'
                                                                                    '      '
                                                                                    'ragged_block_size=ragged_block_size,\n'
                                                                                    '      '
                                                                                    'use_qk_norm=use_qk_norm,\n'
                                                                                    '      '
                                                                                    'query_pre_attn_scalar=query_pre_attn_scalar,\n'
                                                                                    '      '
                                                                                    'use_bias_in_projections=use_bias_in_projections,\n'
                                                                                    '      '
                                                                                    'temperature_tuning=temperature_tuning,\n'
                                                                                    '      '
                                                                                    'temperature_tuning_scale=temperature_tuning_scale,\n'
                                                                                    '      '
                                                                                    'temperature_tuning_floor_scale=temperature_tuning_floor_scale,\n'
                                                                                    '      '
                                                                                    'prefill_query_axis_names=prefill_query_axis_names,\n'
                                                                                    '      '
                                                                                    'prefill_key_axis_names=prefill_key_axis_names,\n'
                                                                                    '      '
                                                                                    'prefill_value_axis_names=prefill_value_axis_names,\n'
                                                                                    '      '
                                                                                    'query_axis_names=query_axis_names,\n'
                                                                                    '      '
                                                                                    'key_axis_names=key_axis_names,\n'
                                                                                    '      '
                                                                                    'value_axis_names=value_axis_names,\n'
                                                                                    '      '
                                                                                    'ep_query_axis_names=ep_query_axis_names,\n'
                                                                                    '      '
                                                                                    'ep_key_axis_names=ep_key_axis_names,\n'
                                                                                    '      '
                                                                                    'ep_value_axis_names=ep_value_axis_names,\n'
                                                                                    '      '
                                                                                    'input_axis_names=input_axis_names,\n'
                                                                                    '      '
                                                                                    'ep_input_axis_names=ep_input_axis_names,\n'
                                                                                    '      '
                                                                                    'out_axis_names=out_axis_names,\n'
                                                                                    '      '
                                                                                    'ep_out_axis_names=ep_out_axis_names,\n'
                                                                                    '      '
                                                                                    'prefill_input_axis_names=prefill_input_axis_names,\n'
                                                                                    '      '
                                                                                    'decode_input_axis_names=decode_input_axis_names,\n'
                                                                                    '      '
                                                                                    'prefill_out_axis_names=prefill_out_axis_names,\n'
                                                                                    '      '
                                                                                    'decode_out_axis_names=decode_out_axis_names,\n'
                                                                                    '      '
                                                                                    'prefill_cache_axis_order=prefill_cache_axis_order,\n'
                                                                                    '      '
                                                                                    'ar_cache_axis_order=ar_cache_axis_order,\n'
                                                                                    '      '
                                                                                    'compute_axis_order=compute_axis_order,\n'
                                                                                    '      '
                                                                                    'reshape_q=reshape_q,\n'
                                                                                    '      '
                                                                                    'is_nope_layer=is_nope_layer,\n'
                                                                                    '      '
                                                                                    'is_vision=is_vision,\n'
                                                                                    '      '
                                                                                    'model_mode=model_mode,\n'
                                                                                    '      '
                                                                                    'q_lora_rank=q_lora_rank,\n'
                                                                                    '      '
                                                                                    'kv_lora_rank=kv_lora_rank,\n'
                                                                                    '      '
                                                                                    'qk_nope_head_dim=qk_nope_head_dim,\n'
                                                                                    '      '
                                                                                    'qk_rope_head_dim=qk_rope_head_dim,\n'
                                                                                    '      '
                                                                                    'v_head_dim=v_head_dim,\n'
                                                                                    '      '
                                                                                    'max_position_embeddings=max_position_embeddings,\n'
                                                                                    '      '
                                                                                    'original_max_position_embeddings=original_max_position_embeddings,\n'
                                                                                    '      '
                                                                                    'mscale=mscale,\n'
                                                                                    '      '
                                                                                    'rope_factor=rope_factor,\n'
                                                                                    '      '
                                                                                    'name=name,\n'
                                                                                    '      '
                                                                                    'metadata_fn=variable_to_logically_partitioned,\n'
                                                                                    '      '
                                                                                    'abstract_init=False,\n'
                                                                                    '  '
                                                                                    ')'],
                                                                                   [0.0,
                                                                                    'MaxText/layers/attention_mla.py#MLA',
                                                                                    'MaxText/layers/attention_mla.py',
                                                                                    'class '
                                                                                    'MLA(Attention):\n'
                                                                                    '  '
                                                                                    '"""Multi-Head '
                                                                                    'Latent '
                                                                                    'Attention '
                                                                                    '(MLA) '
                                                                                    'layer."""\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    '__init__(\n'
                                                                                    '      '
                                                                                    'self,\n'
                                                                                    '      '
                                                                                    'config: '
                                                                                    'Config,\n'
                                                                                    '      '
                                                                                    'num_query_heads: '
                                                                                    'int,\n'
                                                                                    '      '
                                                                                    'num_kv_heads: '
                                                                                    'int,\n'
                                                                                    '      '
                                                                                    'head_dim: '
                                                                                    'int,\n'
                                                                                    '      '
                                                                                    'max_target_length: '
                                                                                    'int,\n'
                                                                                    '      '
                                                                                    'mesh: '
                                                                                    'Mesh,\n'
                                                                                    '      '
                                                                                    'attention_kernel: '
                                                                                    'str,\n'
                                                                                    '      '
                                                                                    'inputs_q_shape: '
                                                                                    'Tuple,\n'
                                                                                    '      '
                                                                                    'inputs_kv_shape: '
                                                                                    'Tuple,\n'
                                                                                    '      '
                                                                                    'dtype: '
                                                                                    'DType '
                                                                                    '= '
                                                                                    'jnp.float32,\n'
                                                                                    '      '
                                                                                    'weight_dtype: '
                                                                                    'DType '
                                                                                    '= '
                                                                                    'jnp.float32,\n'
                                                                                    '      '
                                                                                    'max_prefill_predict_length: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '-1,\n'
                                                                                    '      '
                                                                                    'dropout_rate: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '0.0,\n'
                                                                                    '      '
                                                                                    'kernel_init: '
                                                                                    'NdInitializer '
                                                                                    '= '
                                                                                    'nd_dense_init(1.0, '
                                                                                    '"fan_in", '
                                                                                    '"normal"),\n'
                                                                                    '      '
                                                                                    'float32_qk_product: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'computes '
                                                                                    'logits '
                                                                                    'in '
                                                                                    'float32 '
                                                                                    'for '
                                                                                    'stability.\n'
                                                                                    '      '
                                                                                    'float32_logits: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'cast '
                                                                                    'logits '
                                                                                    'in '
                                                                                    'float32 '
                                                                                    'for '
                                                                                    'stability.\n'
                                                                                    '      '
                                                                                    'quant: '
                                                                                    'Optional[Quant] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'kv_quant: '
                                                                                    'Optional[KVQuant] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'attention_type: '
                                                                                    'AttentionType '
                                                                                    '= '
                                                                                    'AttentionType.GLOBAL,  '
                                                                                    '# '
                                                                                    'Default '
                                                                                    'to '
                                                                                    'global '
                                                                                    'attention\n'
                                                                                    '      '
                                                                                    'attn_logits_soft_cap: '
                                                                                    'float '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'sliding_window_size: '
                                                                                    'int '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'use_ragged_attention: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'ragged_block_size: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '256,\n'
                                                                                    '      '
                                                                                    'use_qk_norm: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'query_pre_attn_scalar: '
                                                                                    'float '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'use_bias_in_projections: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,  '
                                                                                    '# '
                                                                                    'Set '
                                                                                    'to '
                                                                                    'True '
                                                                                    'will '
                                                                                    'enable '
                                                                                    'bias '
                                                                                    'in '
                                                                                    'q, '
                                                                                    'k, '
                                                                                    'v, '
                                                                                    'o '
                                                                                    'projections\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'Temperature '
                                                                                    'tuning '
                                                                                    'parameters '
                                                                                    'used '
                                                                                    'for '
                                                                                    'Llama4\n'
                                                                                    '      '
                                                                                    'temperature_tuning: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'temperature_tuning_scale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '0.1,\n'
                                                                                    '      '
                                                                                    'temperature_tuning_floor_scale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '8192.0,\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'Shard '
                                                                                    'the '
                                                                                    'query '
                                                                                    'activation '
                                                                                    'as '
                                                                                    'the '
                                                                                    'same '
                                                                                    'as '
                                                                                    'the '
                                                                                    'key '
                                                                                    'and '
                                                                                    'value.\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'TODO: '
                                                                                    'Find '
                                                                                    'a '
                                                                                    'better '
                                                                                    'sharding '
                                                                                    'axis '
                                                                                    'name.\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'TODO: '
                                                                                    'Further '
                                                                                    'break '
                                                                                    'down '
                                                                                    'the '
                                                                                    'Training '
                                                                                    'and '
                                                                                    'Inference '
                                                                                    'axes '
                                                                                    'for '
                                                                                    'the '
                                                                                    'q, '
                                                                                    'k, '
                                                                                    'v.\n'
                                                                                    '      '
                                                                                    'prefill_query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'prefill_key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'prefill_value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'ep_query_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'ep_key_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'ep_value_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(KV_BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'KV_HEAD, '
                                                                                    'KV_HEAD_DIM),\n'
                                                                                    '      '
                                                                                    'input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'EMBED),\n'
                                                                                    '      '
                                                                                    'ep_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '      '
                                                                                    'out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH, '
                                                                                    'LENGTH_NO_EXP, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '      '
                                                                                    'ep_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(BATCH_NO_EXP, '
                                                                                    'LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '      '
                                                                                    'prefill_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '      '
                                                                                    'decode_input_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(DECODE_BATCH, '
                                                                                    'DECODE_LENGTH, '
                                                                                    'EMBED),\n'
                                                                                    '      '
                                                                                    'prefill_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(PREFILL_KV_BATCH, '
                                                                                    'PREFILL_LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '      '
                                                                                    'decode_out_axis_names: '
                                                                                    'AxisNames '
                                                                                    '= '
                                                                                    '(DECODE_BATCH, '
                                                                                    'DECODE_LENGTH, '
                                                                                    'HEAD, '
                                                                                    'D_KV),\n'
                                                                                    '      '
                                                                                    'prefill_cache_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(1, '
                                                                                    '2, '
                                                                                    '0, '
                                                                                    '3),\n'
                                                                                    '      '
                                                                                    'ar_cache_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(1, '
                                                                                    '2, '
                                                                                    '0, '
                                                                                    '3),\n'
                                                                                    '      '
                                                                                    'compute_axis_order: '
                                                                                    'AxisIdxes '
                                                                                    '= '
                                                                                    '(0, '
                                                                                    '1, '
                                                                                    '2, '
                                                                                    '3),\n'
                                                                                    '      '
                                                                                    'reshape_q: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'is_nope_layer: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'is_vision: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'model_mode: '
                                                                                    'str '
                                                                                    '= '
                                                                                    'MODEL_MODE_TRAIN,\n'
                                                                                    '      '
                                                                                    'q_lora_rank: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '0,\n'
                                                                                    '      '
                                                                                    'kv_lora_rank: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '512,\n'
                                                                                    '      '
                                                                                    'qk_nope_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '128,\n'
                                                                                    '      '
                                                                                    'qk_rope_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '64,\n'
                                                                                    '      '
                                                                                    'v_head_dim: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '128,\n'
                                                                                    '      '
                                                                                    'max_position_embeddings: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '4096 '
                                                                                    '* '
                                                                                    '4,\n'
                                                                                    '      '
                                                                                    'original_max_position_embeddings: '
                                                                                    'int '
                                                                                    '= '
                                                                                    '4096,\n'
                                                                                    '      '
                                                                                    'mscale: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '1.0,  '
                                                                                    '# '
                                                                                    'scaling '
                                                                                    'factor '
                                                                                    'for '
                                                                                    'softmax\n'
                                                                                    '      '
                                                                                    'rope_factor: '
                                                                                    'float '
                                                                                    '= '
                                                                                    '40.0,  '
                                                                                    '# '
                                                                                    'rotary '
                                                                                    'embedding '
                                                                                    'factor\n'
                                                                                    '      '
                                                                                    'name: '
                                                                                    'str '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'rngs: '
                                                                                    'Optional[nnx.Rngs] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '  '
                                                                                    '):\n'
                                                                                    '    '
                                                                                    '"""Initializes '
                                                                                    'the '
                                                                                    'MLA '
                                                                                    'module.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Args:\n'
                                                                                    '      '
                                                                                    'config: '
                                                                                    'The '
                                                                                    'model '
                                                                                    'configuration.\n'
                                                                                    '      '
                                                                                    '... '
                                                                                    'and '
                                                                                    'other '
                                                                                    'configuration '
                                                                                    'parameters '
                                                                                    'for '
                                                                                    'MLA '
                                                                                    'attention.\n'
                                                                                    '      '
                                                                                    'rngs: '
                                                                                    'The '
                                                                                    'random '
                                                                                    'number '
                                                                                    'generators '
                                                                                    'for '
                                                                                    'initialization, '
                                                                                    'passed '
                                                                                    'by '
                                                                                    'the '
                                                                                    'nnx.to_linen '
                                                                                    'wrapper.\n'
                                                                                    '    '
                                                                                    '"""\n'
                                                                                    '    '
                                                                                    'base_kv_cache '
                                                                                    '= '
                                                                                    'config.attention '
                                                                                    '!= '
                                                                                    '"paged" '
                                                                                    'and '
                                                                                    'config.mla_naive_kvcache\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Setting '
                                                                                    'these '
                                                                                    'before '
                                                                                    'call '
                                                                                    'to '
                                                                                    'super '
                                                                                    'because '
                                                                                    'a '
                                                                                    'field '
                                                                                    'is '
                                                                                    'used '
                                                                                    'in '
                                                                                    'super\n'
                                                                                    '    '
                                                                                    'self.q_lora_rank '
                                                                                    '= '
                                                                                    'q_lora_rank\n'
                                                                                    '    '
                                                                                    'self.kv_lora_rank '
                                                                                    '= '
                                                                                    'kv_lora_rank\n'
                                                                                    '    '
                                                                                    'self.qk_nope_head_dim '
                                                                                    '= '
                                                                                    'qk_nope_head_dim\n'
                                                                                    '    '
                                                                                    'self.qk_rope_head_dim '
                                                                                    '= '
                                                                                    'qk_rope_head_dim\n'
                                                                                    '    '
                                                                                    'self.v_head_dim '
                                                                                    '= '
                                                                                    'v_head_dim\n'
                                                                                    '    '
                                                                                    'self.max_position_embeddings '
                                                                                    '= '
                                                                                    'max_position_embeddings\n'
                                                                                    '    '
                                                                                    'self.original_max_position_embeddings '
                                                                                    '= '
                                                                                    'original_max_position_embeddings\n'
                                                                                    '    '
                                                                                    'self.mscale '
                                                                                    '= '
                                                                                    'mscale\n'
                                                                                    '    '
                                                                                    'self.rope_factor '
                                                                                    '= '
                                                                                    'rope_factor\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'self.qk_head_dim '
                                                                                    '= '
                                                                                    'self.qk_nope_head_dim '
                                                                                    '+ '
                                                                                    'self.qk_rope_head_dim\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'super().__init__(\n'
                                                                                    '        '
                                                                                    'config=config,\n'
                                                                                    '        '
                                                                                    'num_query_heads=num_query_heads,\n'
                                                                                    '        '
                                                                                    'num_kv_heads=num_kv_heads,\n'
                                                                                    '        '
                                                                                    'head_dim=head_dim,\n'
                                                                                    '        '
                                                                                    'max_target_length=max_target_length,\n'
                                                                                    '        '
                                                                                    'mesh=mesh,\n'
                                                                                    '        '
                                                                                    'attention_kernel=attention_kernel,\n'
                                                                                    '        '
                                                                                    'inputs_q_shape=inputs_q_shape,\n'
                                                                                    '        '
                                                                                    'inputs_kv_shape=inputs_kv_shape,\n'
                                                                                    '        '
                                                                                    'dtype=dtype,\n'
                                                                                    '        '
                                                                                    'weight_dtype=weight_dtype,\n'
                                                                                    '        '
                                                                                    'max_prefill_predict_length=max_prefill_predict_length,\n'
                                                                                    '        '
                                                                                    'dropout_rate=dropout_rate,\n'
                                                                                    '        '
                                                                                    'kernel_init=kernel_init,\n'
                                                                                    '        '
                                                                                    'float32_qk_product=float32_qk_product,\n'
                                                                                    '        '
                                                                                    'float32_logits=float32_logits,\n'
                                                                                    '        '
                                                                                    'quant=quant,\n'
                                                                                    '        '
                                                                                    'kv_quant=kv_quant,\n'
                                                                                    '        '
                                                                                    'attention_type=attention_type,\n'
                                                                                    '        '
                                                                                    'attn_logits_soft_cap=attn_logits_soft_cap,\n'
                                                                                    '        '
                                                                                    'sliding_window_size=sliding_window_size,\n'
                                                                                    '        '
                                                                                    'use_ragged_attention=use_ragged_attention,\n'
                                                                                    '        '
                                                                                    'ragged_block_size=ragged_block_size,\n'
                                                                                    '        '
                                                                                    'use_qk_norm=use_qk_norm,\n'
                                                                                    '        '
                                                                                    'query_pre_attn_scalar=query_pre_attn_scalar,\n'
                                                                                    '        '
                                                                                    'use_bias_in_projections=use_bias_in_projections,\n'
                                                                                    '        '
                                                                                    'temperature_tuning=temperature_tuning,\n'
                                                                                    '        '
                                                                                    'temperature_tuning_scale=temperature_tuning_scale,\n'
                                                                                    '        '
                                                                                    'temperature_tuning_floor_scale=temperature_tuning_floor_scale,\n'
                                                                                    '        '
                                                                                    'prefill_query_axis_names=prefill_query_axis_names,\n'
                                                                                    '        '
                                                                                    'prefill_key_axis_names=prefill_key_axis_names,\n'
                                                                                    '        '
                                                                                    'prefill_value_axis_names=prefill_value_axis_names,\n'
                                                                                    '        '
                                                                                    'query_axis_names=query_axis_names,\n'
                                                                                    '        '
                                                                                    'key_axis_names=key_axis_names,\n'
                                                                                    '        '
                                                                                    'value_axis_names=value_axis_names,\n'
                                                                                    '        '
                                                                                    'ep_query_axis_names=ep_query_axis_names,\n'
                                                                                    '        '
                                                                                    'ep_key_axis_names=ep_key_axis_names,\n'
                                                                                    '        '
                                                                                    'ep_value_axis_names=ep_value_axis_names,\n'
                                                                                    '        '
                                                                                    'input_axis_names=input_axis_names,\n'
                                                                                    '        '
                                                                                    'ep_input_axis_names=ep_input_axis_names,\n'
                                                                                    '        '
                                                                                    'out_axis_names=out_axis_names,\n'
                                                                                    '        '
                                                                                    'ep_out_axis_names=ep_out_axis_names,\n'
                                                                                    '        '
                                                                                    'prefill_input_axis_names=prefill_input_axis_names,\n'
                                                                                    '        '
                                                                                    'decode_input_axis_names=decode_input_axis_names,\n'
                                                                                    '        '
                                                                                    'prefill_out_axis_names=prefill_out_axis_names,\n'
                                                                                    '        '
                                                                                    'decode_out_axis_names=decode_out_axis_names,\n'
                                                                                    '        '
                                                                                    'prefill_cache_axis_order=prefill_cache_axis_order,\n'
                                                                                    '        '
                                                                                    'ar_cache_axis_order=ar_cache_axis_order,\n'
                                                                                    '        '
                                                                                    'compute_axis_order=compute_axis_order,\n'
                                                                                    '        '
                                                                                    'reshape_q=reshape_q,\n'
                                                                                    '        '
                                                                                    'is_nope_layer=is_nope_layer,\n'
                                                                                    '        '
                                                                                    'is_vision=is_vision,\n'
                                                                                    '        '
                                                                                    'model_mode=model_mode,\n'
                                                                                    '        '
                                                                                    'base_kv_cache=base_kv_cache,\n'
                                                                                    '        '
                                                                                    'rngs=rngs,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Module '
                                                                                    'attribute '
                                                                                    'names '
                                                                                    'must '
                                                                                    'match '
                                                                                    'names '
                                                                                    'previously '
                                                                                    'passed '
                                                                                    'to '
                                                                                    'Linen '
                                                                                    'for '
                                                                                    'checkpointing\n'
                                                                                    '    '
                                                                                    'self.MlaKVCache_0 '
                                                                                    '= '
                                                                                    'self.init_mla_kv_caches(inputs_kv_shape) '
                                                                                    'if '
                                                                                    'model_mode '
                                                                                    '!= '
                                                                                    'MODEL_MODE_TRAIN '
                                                                                    'else '
                                                                                    'None\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Assert '
                                                                                    'required '
                                                                                    'configuration '
                                                                                    'parameters '
                                                                                    'for '
                                                                                    'MLA '
                                                                                    'attention.\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    '(\n'
                                                                                    '        '
                                                                                    'self.config.attention_type '
                                                                                    '== '
                                                                                    'AttentionType.MLA.value\n'
                                                                                    '    '
                                                                                    '), '
                                                                                    'f"MLA '
                                                                                    'requires '
                                                                                    'MLA '
                                                                                    'attention '
                                                                                    'type '
                                                                                    '{AttentionType.MLA.value}"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'self.kv_lora_rank '
                                                                                    '> '
                                                                                    '0, '
                                                                                    '"KV '
                                                                                    'LoRA '
                                                                                    'rank '
                                                                                    'must '
                                                                                    'be '
                                                                                    '> '
                                                                                    '0"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'self.qk_nope_head_dim '
                                                                                    '> '
                                                                                    '0, '
                                                                                    '"QK '
                                                                                    'NoPe '
                                                                                    'head '
                                                                                    'dim '
                                                                                    'must '
                                                                                    'be '
                                                                                    '> '
                                                                                    '0"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'self.qk_rope_head_dim '
                                                                                    '> '
                                                                                    '0, '
                                                                                    '"QK '
                                                                                    'RoPE '
                                                                                    'head '
                                                                                    'dim '
                                                                                    'must '
                                                                                    'be '
                                                                                    '> '
                                                                                    '0"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'self.v_head_dim '
                                                                                    '> '
                                                                                    '0, '
                                                                                    '"V '
                                                                                    'head '
                                                                                    'dim '
                                                                                    'must '
                                                                                    'be '
                                                                                    '> '
                                                                                    '0"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'self.num_query_heads '
                                                                                    '== '
                                                                                    'self.num_kv_heads, '
                                                                                    '"MLA '
                                                                                    'requires '
                                                                                    'equal '
                                                                                    'number '
                                                                                    'of '
                                                                                    'query '
                                                                                    'and '
                                                                                    'kv '
                                                                                    'heads"\n'
                                                                                    '    '
                                                                                    'assert '
                                                                                    'not '
                                                                                    'self.config.fused_qkv, '
                                                                                    '"Fused '
                                                                                    'QKV '
                                                                                    'is '
                                                                                    'not '
                                                                                    'supported '
                                                                                    'for '
                                                                                    'MLA"\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.q_lora_rank '
                                                                                    '== '
                                                                                    '0:\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'Standard '
                                                                                    'Q '
                                                                                    'projection '
                                                                                    '(without '
                                                                                    'LoRA).\n'
                                                                                    '      '
                                                                                    'self.query '
                                                                                    '= '
                                                                                    'DenseGeneral(\n'
                                                                                    '          '
                                                                                    'in_features_shape=self.config.emb_dim,\n'
                                                                                    '          '
                                                                                    'out_features_shape=(self.num_query_heads, '
                                                                                    'self.qk_head_dim),\n'
                                                                                    '          '
                                                                                    'axis=-1,\n'
                                                                                    '          '
                                                                                    'kernel_init=self.kernel_init,\n'
                                                                                    '          '
                                                                                    'kernel_axes=("embed", '
                                                                                    '"q_heads", '
                                                                                    '"kv"),\n'
                                                                                    '          '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '          '
                                                                                    'weight_dtype=self.weight_dtype,\n'
                                                                                    '          '
                                                                                    'quant=self.quant,\n'
                                                                                    '          '
                                                                                    'matmul_precision=self.config.matmul_precision,\n'
                                                                                    '          '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'LoRA '
                                                                                    'path '
                                                                                    'for '
                                                                                    'Q.\n'
                                                                                    '      '
                                                                                    'self.wq_a '
                                                                                    '= '
                                                                                    'DenseGeneral(\n'
                                                                                    '          '
                                                                                    'in_features_shape=self.config.emb_dim,\n'
                                                                                    '          '
                                                                                    'out_features_shape=self.q_lora_rank,\n'
                                                                                    '          '
                                                                                    'axis=-1,\n'
                                                                                    '          '
                                                                                    'kernel_init=self.kernel_init,\n'
                                                                                    '          '
                                                                                    'kernel_axes=("embed", '
                                                                                    '"q_lora"),\n'
                                                                                    '          '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '          '
                                                                                    'weight_dtype=self.weight_dtype,\n'
                                                                                    '          '
                                                                                    'quant=self.quant,\n'
                                                                                    '          '
                                                                                    'matmul_precision=self.config.matmul_precision,\n'
                                                                                    '          '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '      '
                                                                                    'self.q_norm '
                                                                                    '= '
                                                                                    'RMSNorm(\n'
                                                                                    '          '
                                                                                    'num_features=self.q_lora_rank,\n'
                                                                                    '          '
                                                                                    'dtype=self.config.dtype,\n'
                                                                                    '          '
                                                                                    'weight_dtype=self.config.weight_dtype,\n'
                                                                                    '          '
                                                                                    'epsilon=self.config.normalization_layer_epsilon,\n'
                                                                                    '          '
                                                                                    'kernel_axes=("norm",),\n'
                                                                                    '          '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '      '
                                                                                    'self.wq_b '
                                                                                    '= '
                                                                                    'DenseGeneral(\n'
                                                                                    '          '
                                                                                    'in_features_shape=self.q_lora_rank,\n'
                                                                                    '          '
                                                                                    'out_features_shape=(self.num_query_heads, '
                                                                                    'self.qk_head_dim),\n'
                                                                                    '          '
                                                                                    'axis=-1,\n'
                                                                                    '          '
                                                                                    'kernel_init=self.kernel_init,\n'
                                                                                    '          '
                                                                                    'kernel_axes=("q_lora", '
                                                                                    '"q_heads", '
                                                                                    '"kv"),\n'
                                                                                    '          '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '          '
                                                                                    'weight_dtype=self.weight_dtype,\n'
                                                                                    '          '
                                                                                    'quant=self.quant,\n'
                                                                                    '          '
                                                                                    'matmul_precision=self.config.matmul_precision,\n'
                                                                                    '          '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'KV '
                                                                                    'LoRA '
                                                                                    'path.\n'
                                                                                    '    '
                                                                                    'self.wkv_a '
                                                                                    '= '
                                                                                    'DenseGeneral(\n'
                                                                                    '        '
                                                                                    'in_features_shape=self.config.emb_dim,\n'
                                                                                    '        '
                                                                                    'out_features_shape=self.kv_lora_rank '
                                                                                    '+ '
                                                                                    'self.qk_rope_head_dim,\n'
                                                                                    '        '
                                                                                    'axis=-1,\n'
                                                                                    '        '
                                                                                    'kernel_init=self.kernel_init,\n'
                                                                                    '        '
                                                                                    'kernel_axes=("embed", '
                                                                                    '"kv_lora"),\n'
                                                                                    '        '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '        '
                                                                                    'weight_dtype=self.weight_dtype,\n'
                                                                                    '        '
                                                                                    'quant=self.quant,\n'
                                                                                    '        '
                                                                                    'matmul_precision=self.config.matmul_precision,\n'
                                                                                    '        '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '    '
                                                                                    'self.kv_norm '
                                                                                    '= '
                                                                                    'RMSNorm(\n'
                                                                                    '        '
                                                                                    'num_features=self.kv_lora_rank,\n'
                                                                                    '        '
                                                                                    'dtype=self.config.dtype,\n'
                                                                                    '        '
                                                                                    'weight_dtype=self.config.weight_dtype,\n'
                                                                                    '        '
                                                                                    'epsilon=self.config.normalization_layer_epsilon,\n'
                                                                                    '        '
                                                                                    'kernel_axes=("norm",),\n'
                                                                                    '        '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '    '
                                                                                    'self.wkv_b '
                                                                                    '= '
                                                                                    'DenseGeneral(\n'
                                                                                    '        '
                                                                                    'in_features_shape=self.kv_lora_rank,\n'
                                                                                    '        '
                                                                                    'out_features_shape=(\n'
                                                                                    '            '
                                                                                    'self.num_query_heads,\n'
                                                                                    '            '
                                                                                    '(self.qk_nope_head_dim '
                                                                                    '+ '
                                                                                    'self.v_head_dim),\n'
                                                                                    '        '
                                                                                    '),\n'
                                                                                    '        '
                                                                                    'axis=-1,\n'
                                                                                    '        '
                                                                                    'kernel_init=self.kernel_init,\n'
                                                                                    '        '
                                                                                    'kernel_axes=("kv_lora", '
                                                                                    '"kv_heads", '
                                                                                    '"kv_head_dim"),\n'
                                                                                    '        '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '        '
                                                                                    'weight_dtype=self.weight_dtype,\n'
                                                                                    '        '
                                                                                    'quant=self.quant,\n'
                                                                                    '        '
                                                                                    'matmul_precision=self.config.matmul_precision,\n'
                                                                                    '        '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Set '
                                                                                    'softmax '
                                                                                    'scaling.\n'
                                                                                    '    '
                                                                                    'self.softmax_scale '
                                                                                    '= '
                                                                                    'self.qk_head_dim**-0.5\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.max_position_embeddings '
                                                                                    '> '
                                                                                    'self.original_max_position_embeddings:\n'
                                                                                    '      '
                                                                                    'mscale '
                                                                                    '= '
                                                                                    '0.1 '
                                                                                    '* '
                                                                                    'self.mscale '
                                                                                    '* '
                                                                                    'jnp.log(self.rope_factor) '
                                                                                    '+ '
                                                                                    '1.0\n'
                                                                                    '      '
                                                                                    'self.softmax_scale '
                                                                                    '= '
                                                                                    'self.softmax_scale '
                                                                                    '* '
                                                                                    'mscale '
                                                                                    '* '
                                                                                    'mscale\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Setup '
                                                                                    'paged '
                                                                                    'attention '
                                                                                    'op\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.config.attention '
                                                                                    '== '
                                                                                    '"paged":\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'Set '
                                                                                    'head_dim '
                                                                                    'to '
                                                                                    'the '
                                                                                    'max '
                                                                                    'of '
                                                                                    'qk_head_dim '
                                                                                    'and '
                                                                                    'v_head_dim. '
                                                                                    'The '
                                                                                    'current '
                                                                                    'paged\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'attention '
                                                                                    'kernel '
                                                                                    'requires '
                                                                                    'the '
                                                                                    'head_dim '
                                                                                    'to '
                                                                                    'be '
                                                                                    'the '
                                                                                    'same '
                                                                                    'for '
                                                                                    'q, '
                                                                                    'k, '
                                                                                    'v.\n'
                                                                                    '      '
                                                                                    'head_dim '
                                                                                    '= '
                                                                                    'max(self.qk_head_dim, '
                                                                                    'self.v_head_dim)\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'Align '
                                                                                    'head_dim '
                                                                                    'to '
                                                                                    'the '
                                                                                    'pagedattn_head_dim_alignment '
                                                                                    'if '
                                                                                    'specified.\n'
                                                                                    '      '
                                                                                    'if '
                                                                                    'self.config.pagedattn_head_dim_alignment '
                                                                                    '> '
                                                                                    '0:\n'
                                                                                    '        '
                                                                                    'alignment '
                                                                                    '= '
                                                                                    'self.config.pagedattn_head_dim_alignment\n'
                                                                                    '        '
                                                                                    'head_dim '
                                                                                    '= '
                                                                                    '(head_dim '
                                                                                    '+ '
                                                                                    'alignment '
                                                                                    '- '
                                                                                    '1) '
                                                                                    '// '
                                                                                    'alignment '
                                                                                    '* '
                                                                                    'alignment\n'
                                                                                    '      '
                                                                                    'self.ds_paged_attention_op '
                                                                                    '= '
                                                                                    'paged_attention.PagedAttentionOp(\n'
                                                                                    '          '
                                                                                    'mesh=self.mesh,\n'
                                                                                    '          '
                                                                                    'num_pages=self.config.pagedattn_num_pages,\n'
                                                                                    '          '
                                                                                    'tokens_per_page=self.config.pagedattn_tokens_per_page,\n'
                                                                                    '          '
                                                                                    'max_pages_per_slot=(self.config.max_target_length '
                                                                                    '+ '
                                                                                    'self.config.pagedattn_tokens_per_page '
                                                                                    '- '
                                                                                    '1)\n'
                                                                                    '          '
                                                                                    '// '
                                                                                    'self.config.pagedattn_tokens_per_page,\n'
                                                                                    '          '
                                                                                    'max_pages_per_prefill=(self.config.max_prefill_predict_length '
                                                                                    '+ '
                                                                                    'self.config.pagedattn_tokens_per_page '
                                                                                    '- '
                                                                                    '1)\n'
                                                                                    '          '
                                                                                    '// '
                                                                                    'self.config.pagedattn_tokens_per_page,\n'
                                                                                    '          '
                                                                                    'pages_per_compute_block=self.config.pagedattn_pages_per_compute_block,\n'
                                                                                    '          '
                                                                                    'num_kv_heads=self.num_kv_heads,\n'
                                                                                    '          '
                                                                                    'kv_head_dim_size=head_dim,\n'
                                                                                    '          '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '          '
                                                                                    'attn_logits_soft_cap=self.attn_logits_soft_cap,\n'
                                                                                    '          '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    'mla_query_projection(self, '
                                                                                    'inputs_q: '
                                                                                    'Array, '
                                                                                    'inputs_positions: '
                                                                                    'Array, '
                                                                                    'model_mode) '
                                                                                    '-> '
                                                                                    'Array:\n'
                                                                                    '    '
                                                                                    '"""Query '
                                                                                    'projection '
                                                                                    'for '
                                                                                    'MLA, '
                                                                                    'e.g. '
                                                                                    'includes '
                                                                                    'LoRA '
                                                                                    'if '
                                                                                    'q_lora_rank '
                                                                                    '> '
                                                                                    '0."""\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Set '
                                                                                    'softmax '
                                                                                    'scaling.\n'
                                                                                    '    '
                                                                                    'self.qk_head_dim '
                                                                                    '= '
                                                                                    'self.qk_nope_head_dim '
                                                                                    '+ '
                                                                                    'self.qk_rope_head_dim\n'
                                                                                    '    '
                                                                                    'self.softmax_scale '
                                                                                    '= '
                                                                                    'self.qk_head_dim**-0.5\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.max_position_embeddings '
                                                                                    '> '
                                                                                    'self.original_max_position_embeddings:\n'
                                                                                    '      '
                                                                                    'mscale '
                                                                                    '= '
                                                                                    '0.1 '
                                                                                    '* '
                                                                                    'self.mscale '
                                                                                    '* '
                                                                                    'jnp.log(self.rope_factor) '
                                                                                    '+ '
                                                                                    '1.0\n'
                                                                                    '      '
                                                                                    'self.softmax_scale '
                                                                                    '= '
                                                                                    'self.softmax_scale '
                                                                                    '* '
                                                                                    'mscale '
                                                                                    '* '
                                                                                    'mscale\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.q_lora_rank '
                                                                                    '== '
                                                                                    '0:\n'
                                                                                    '      '
                                                                                    'q '
                                                                                    '= '
                                                                                    'self.query(inputs_q)\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    '# '
                                                                                    'LoRA '
                                                                                    'path\n'
                                                                                    '      '
                                                                                    'low_rank_q '
                                                                                    '= '
                                                                                    'self.wq_a(inputs_q)  '
                                                                                    '# '
                                                                                    '[B, '
                                                                                    'L, '
                                                                                    'q_lora_rank]\n'
                                                                                    '      '
                                                                                    'low_rank_q '
                                                                                    '= '
                                                                                    'self.q_norm(low_rank_q)  '
                                                                                    '# '
                                                                                    'RMSNorm '
                                                                                    'on '
                                                                                    'low '
                                                                                    'rank\n'
                                                                                    '      '
                                                                                    'q '
                                                                                    '= '
                                                                                    'self.wq_b(low_rank_q)  '
                                                                                    '# '
                                                                                    '[B, '
                                                                                    'L, '
                                                                                    'n_heads '
                                                                                    '* '
                                                                                    'qk_head_dim]\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Split '
                                                                                    'into '
                                                                                    'non-positional '
                                                                                    'and '
                                                                                    'rotary '
                                                                                    'parts.\n'
                                                                                    '    '
                                                                                    'q_nope, '
                                                                                    'q_pe '
                                                                                    '= '
                                                                                    'jnp.split(q, '
                                                                                    '[self.qk_nope_head_dim], '
                                                                                    'axis=-1)\n'
                                                                                    '    '
                                                                                    'q_pe '
                                                                                    '= '
                                                                                    'self.apply_rotary_embedding(q_pe, '
                                                                                    'inputs_positions=inputs_positions)\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Query '
                                                                                    'projection '
                                                                                    'is '
                                                                                    'scaled '
                                                                                    'by '
                                                                                    'self.softmax_scale '
                                                                                    'to '
                                                                                    'be '
                                                                                    'consistent '
                                                                                    'MaxText '
                                                                                    'implementation.\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'DeepSeek '
                                                                                    'v3 '
                                                                                    'was '
                                                                                    'doing '
                                                                                    'it '
                                                                                    'in '
                                                                                    'attention '
                                                                                    'score '
                                                                                    'computation.\n'
                                                                                    '    '
                                                                                    'query '
                                                                                    '= '
                                                                                    'jnp.concatenate([q_nope, '
                                                                                    'q_pe], '
                                                                                    'axis=-1) '
                                                                                    '* '
                                                                                    'self.softmax_scale\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_PREFILL:\n'
                                                                                    '      '
                                                                                    'query '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(query, '
                                                                                    'self.prefill_query_axis_names)\n'
                                                                                    '    '
                                                                                    'elif '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_TRAIN '
                                                                                    'and '
                                                                                    'self.config.expert_shard_attention_option '
                                                                                    '== '
                                                                                    'EP_AS_CONTEXT:\n'
                                                                                    '      '
                                                                                    'query '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(query, '
                                                                                    'self.ep_query_axis_names)\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'query '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(query, '
                                                                                    'self.query_axis_names)\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    'query\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    'mla_get_key_value(self, '
                                                                                    'low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'model_mode):\n'
                                                                                    '    '
                                                                                    '"""get '
                                                                                    '(key,value) '
                                                                                    'pair '
                                                                                    'from '
                                                                                    'mla"""\n'
                                                                                    '    '
                                                                                    'kv_out '
                                                                                    '= '
                                                                                    'self.wkv_b(low_rank_main)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Split '
                                                                                    'kv_out '
                                                                                    'into '
                                                                                    'key_nope '
                                                                                    'and '
                                                                                    'value '
                                                                                    'parts.\n'
                                                                                    '    '
                                                                                    'key_nope, '
                                                                                    'value '
                                                                                    '= '
                                                                                    'jnp.split(kv_out, '
                                                                                    '[self.qk_nope_head_dim], '
                                                                                    'axis=-1)\n'
                                                                                    '    '
                                                                                    'key_rope '
                                                                                    '= '
                                                                                    'jnp.broadcast_to(key_rope, '
                                                                                    '(key_nope.shape[0], '
                                                                                    'key_nope.shape[1], '
                                                                                    'self.num_query_heads, '
                                                                                    'key_rope.shape[3]))\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'key '
                                                                                    '= '
                                                                                    'jnp.concatenate([key_nope, '
                                                                                    'key_rope], '
                                                                                    'axis=-1)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_PREFILL:\n'
                                                                                    '      '
                                                                                    'key '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(key, '
                                                                                    'self.prefill_key_axis_names)\n'
                                                                                    '      '
                                                                                    'value '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(value, '
                                                                                    'self.prefill_value_axis_names)\n'
                                                                                    '    '
                                                                                    'elif '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_TRAIN '
                                                                                    'and '
                                                                                    'self.config.expert_shard_attention_option '
                                                                                    '== '
                                                                                    'EP_AS_CONTEXT:\n'
                                                                                    '      '
                                                                                    'key '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(key, '
                                                                                    'self.ep_key_axis_names)\n'
                                                                                    '      '
                                                                                    'value '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(value, '
                                                                                    'self.ep_value_axis_names)\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'key '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(key, '
                                                                                    'self.key_axis_names)\n'
                                                                                    '      '
                                                                                    'value '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(value, '
                                                                                    'self.value_axis_names)\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    'key, '
                                                                                    'value\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    'init_mla_kv_caches(self, '
                                                                                    'inputs_kv_shape: '
                                                                                    'Tuple):\n'
                                                                                    '    '
                                                                                    '"""Initializes '
                                                                                    'MlaKVCache.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Args:\n'
                                                                                    '      '
                                                                                    'inputs_kv_shape: '
                                                                                    'Key/value '
                                                                                    'inputs '
                                                                                    'shape '
                                                                                    'for '
                                                                                    'initialization.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Returns:\n'
                                                                                    '      '
                                                                                    'An '
                                                                                    'MlaKVCache '
                                                                                    'module '
                                                                                    'instance.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Raises:\n'
                                                                                    '      '
                                                                                    'ValueError: '
                                                                                    'If '
                                                                                    'the '
                                                                                    'configuration '
                                                                                    'is '
                                                                                    'invalid.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '"""\n'
                                                                                    '    '
                                                                                    'batch_size, '
                                                                                    '_, '
                                                                                    '_ '
                                                                                    '= '
                                                                                    'inputs_kv_shape\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'During '
                                                                                    'initialization, '
                                                                                    'seq_len '
                                                                                    'of '
                                                                                    'inputs_kv '
                                                                                    'is '
                                                                                    'max_target_length,\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'which '
                                                                                    'is '
                                                                                    'not '
                                                                                    'always '
                                                                                    'correct '
                                                                                    'for '
                                                                                    'some '
                                                                                    'functions '
                                                                                    'in '
                                                                                    'MlaKVCache.\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'However, '
                                                                                    'MlaKVCache '
                                                                                    'internal '
                                                                                    'cache '
                                                                                    'shapes '
                                                                                    'are '
                                                                                    'based '
                                                                                    'on '
                                                                                    'max_prefill_length\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'and '
                                                                                    'max_target_length, '
                                                                                    'not '
                                                                                    'the '
                                                                                    'passed '
                                                                                    'seq_len.\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'We '
                                                                                    'can '
                                                                                    'use '
                                                                                    'a '
                                                                                    'placeholder '
                                                                                    'value. '
                                                                                    'The '
                                                                                    'correct '
                                                                                    'fix '
                                                                                    'might '
                                                                                    'involve '
                                                                                    'refactoring\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'MlaKVCache.\n'
                                                                                    '    '
                                                                                    'placeholder_seq_len '
                                                                                    '= '
                                                                                    '1\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    'kvcache.MlaKVCache(\n'
                                                                                    '        '
                                                                                    'max_prefill_length=self.max_prefill_predict_length,\n'
                                                                                    '        '
                                                                                    'max_target_length=self.max_target_length,\n'
                                                                                    '        '
                                                                                    'batch=batch_size,\n'
                                                                                    '        '
                                                                                    'key_seq_len=placeholder_seq_len,\n'
                                                                                    '        '
                                                                                    'value_seq_len=placeholder_seq_len,\n'
                                                                                    '        '
                                                                                    'key_head_size=self.kv_lora_rank,\n'
                                                                                    '        '
                                                                                    'value_head_size=self.qk_rope_head_dim,\n'
                                                                                    '        '
                                                                                    'dtype=self.dtype,\n'
                                                                                    '        '
                                                                                    'kv_quant=self.kv_quant,\n'
                                                                                    '        '
                                                                                    'prefill_cache_axis_order=self.prefill_cache_axis_order,\n'
                                                                                    '        '
                                                                                    'ar_cache_axis_order=self.ar_cache_axis_order,\n'
                                                                                    '        '
                                                                                    'model_mode=self.model_mode,\n'
                                                                                    '        '
                                                                                    'use_chunked_prefill=self.config.use_chunked_prefill,\n'
                                                                                    '        '
                                                                                    'rngs=self.rngs,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    'update_mla_kv_caches(self, '
                                                                                    'low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk=None):\n'
                                                                                    '    '
                                                                                    '"""Updates '
                                                                                    'the '
                                                                                    'MLA '
                                                                                    '(Multi-Head '
                                                                                    'Latent '
                                                                                    'Attention) '
                                                                                    'KV '
                                                                                    'caches.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'This '
                                                                                    'method '
                                                                                    'is '
                                                                                    'specific '
                                                                                    'to '
                                                                                    'the '
                                                                                    'MLA '
                                                                                    'attention '
                                                                                    'mechanism. '
                                                                                    'It '
                                                                                    'calls '
                                                                                    'the\n'
                                                                                    '    '
                                                                                    '`mla_kv_cache_as_linen` '
                                                                                    'module '
                                                                                    'to '
                                                                                    'update '
                                                                                    'and '
                                                                                    'retrieve '
                                                                                    'the '
                                                                                    'caches, '
                                                                                    'which\n'
                                                                                    '    '
                                                                                    'store '
                                                                                    'latent '
                                                                                    'representations '
                                                                                    '(`low_rank_main`) '
                                                                                    'and '
                                                                                    'RoPE-applied '
                                                                                    'keys\n'
                                                                                    '    '
                                                                                    '(`key_rope`). '
                                                                                    'It '
                                                                                    'then '
                                                                                    'reconstructs '
                                                                                    'the '
                                                                                    'full '
                                                                                    'key '
                                                                                    'and '
                                                                                    'value '
                                                                                    'tensors '
                                                                                    'from\n'
                                                                                    '    '
                                                                                    'the '
                                                                                    'cached '
                                                                                    'components.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Args:\n'
                                                                                    '      '
                                                                                    'low_rank_main: '
                                                                                    'The '
                                                                                    'main '
                                                                                    'latent '
                                                                                    'component '
                                                                                    'of '
                                                                                    'the '
                                                                                    'key.\n'
                                                                                    '      '
                                                                                    'key_rope: '
                                                                                    'The '
                                                                                    'RoPE-applied '
                                                                                    'component '
                                                                                    'of '
                                                                                    'the '
                                                                                    'key.\n'
                                                                                    '      '
                                                                                    'decoder_segment_ids: '
                                                                                    'Segment '
                                                                                    'IDs '
                                                                                    'for '
                                                                                    'decoder '
                                                                                    'masking.\n'
                                                                                    '      '
                                                                                    'model_mode: '
                                                                                    'The '
                                                                                    'operational '
                                                                                    'mode '
                                                                                    "('train', "
                                                                                    "'prefill', "
                                                                                    "'autoregressive').\n"
                                                                                    '      '
                                                                                    'previous_chunk: '
                                                                                    'Information '
                                                                                    'about '
                                                                                    'previously '
                                                                                    'processed '
                                                                                    'chunks, '
                                                                                    'for\n'
                                                                                    '        '
                                                                                    'chunked '
                                                                                    'prefill.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Returns:\n'
                                                                                    '      '
                                                                                    'A '
                                                                                    'list '
                                                                                    'containing '
                                                                                    'two '
                                                                                    'elements:\n'
                                                                                    '      '
                                                                                    '- '
                                                                                    'The '
                                                                                    'prefill '
                                                                                    'key-value '
                                                                                    'cache, '
                                                                                    'reconstructed '
                                                                                    'from '
                                                                                    'the '
                                                                                    'MLA '
                                                                                    'cache, '
                                                                                    'or '
                                                                                    'None.\n'
                                                                                    '      '
                                                                                    '- '
                                                                                    'The '
                                                                                    'autoregressive '
                                                                                    'key-value '
                                                                                    'cache, '
                                                                                    'reconstructed '
                                                                                    'from '
                                                                                    'the '
                                                                                    'MLA '
                                                                                    'cache, '
                                                                                    'or '
                                                                                    'None.\n'
                                                                                    '    '
                                                                                    '"""\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'prefill_mla_cache, '
                                                                                    'ar_mla_cache '
                                                                                    '= '
                                                                                    'self.MlaKVCache_0(\n'
                                                                                    '        '
                                                                                    'key_latent=low_rank_main,\n'
                                                                                    '        '
                                                                                    'key_rope=key_rope,\n'
                                                                                    '        '
                                                                                    'decoder_segment_ids=decoder_segment_ids,\n'
                                                                                    '        '
                                                                                    'model_mode=model_mode,\n'
                                                                                    '        '
                                                                                    'use_ragged_attention=self.use_ragged_attention,\n'
                                                                                    '        '
                                                                                    'previous_chunk=previous_chunk,\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'prefill_mla_cache:\n'
                                                                                    '      '
                                                                                    'low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'decoder_segment_ids '
                                                                                    '= '
                                                                                    'prefill_mla_cache\n'
                                                                                    '      '
                                                                                    'key, '
                                                                                    'value '
                                                                                    '= '
                                                                                    'self.mla_get_key_value(low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'model_mode)\n'
                                                                                    '      '
                                                                                    'prefill_kv_cache '
                                                                                    '= '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'decoder_segment_ids\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'prefill_kv_cache '
                                                                                    '= '
                                                                                    'None\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'ar_mla_cache:\n'
                                                                                    '      '
                                                                                    'low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'decoder_segment_ids, '
                                                                                    'lengths '
                                                                                    '= '
                                                                                    'ar_mla_cache\n'
                                                                                    '      '
                                                                                    'key, '
                                                                                    'value '
                                                                                    '= '
                                                                                    'self.mla_get_key_value(low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'model_mode)\n'
                                                                                    '      '
                                                                                    'ar_kv_cache '
                                                                                    '= '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'decoder_segment_ids, '
                                                                                    'lengths\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'ar_kv_cache '
                                                                                    '= '
                                                                                    'None\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    '[prefill_kv_cache, '
                                                                                    'ar_kv_cache]\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    'mla_kv_projection(self, '
                                                                                    'inputs: '
                                                                                    'Array, '
                                                                                    'inputs_positions: '
                                                                                    'Array, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk):\n'
                                                                                    '    '
                                                                                    '"""MLA '
                                                                                    'key/value '
                                                                                    'projection '
                                                                                    'with '
                                                                                    'integrated '
                                                                                    'rotary '
                                                                                    'embedding."""\n'
                                                                                    '    '
                                                                                    'low_rank '
                                                                                    '= '
                                                                                    'self.wkv_a(inputs)\n'
                                                                                    '    '
                                                                                    'low_rank_main, '
                                                                                    'low_rank_rope '
                                                                                    '= '
                                                                                    'jnp.split(low_rank, '
                                                                                    '[self.kv_lora_rank], '
                                                                                    'axis=-1)\n'
                                                                                    '    '
                                                                                    'low_rank_main '
                                                                                    '= '
                                                                                    'self.kv_norm(low_rank_main)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    '# '
                                                                                    'Apply '
                                                                                    'rotary '
                                                                                    'embedding '
                                                                                    'to '
                                                                                    'key_rope.\n'
                                                                                    '    '
                                                                                    'key_rope '
                                                                                    '= '
                                                                                    'jnp.expand_dims(low_rank_rope, '
                                                                                    'axis=2)\n'
                                                                                    '    '
                                                                                    'key_rope '
                                                                                    '= '
                                                                                    'self.apply_rotary_embedding(key_rope, '
                                                                                    'inputs_positions=inputs_positions)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'key, '
                                                                                    'value '
                                                                                    '= '
                                                                                    'self.mla_get_key_value(low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'model_mode)\n'
                                                                                    '    '
                                                                                    'cached_values '
                                                                                    '= '
                                                                                    '[None, '
                                                                                    'None]\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.config.attention '
                                                                                    '!= '
                                                                                    '"paged" '
                                                                                    'and '
                                                                                    'model_mode '
                                                                                    '!= '
                                                                                    'MODEL_MODE_TRAIN:\n'
                                                                                    '      '
                                                                                    'if '
                                                                                    'self.config.mla_naive_kvcache:\n'
                                                                                    '        '
                                                                                    'cached_values '
                                                                                    '= '
                                                                                    'self.update_kv_caches(key, '
                                                                                    'value, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk)\n'
                                                                                    '      '
                                                                                    'else:\n'
                                                                                    '        '
                                                                                    'cached_values '
                                                                                    '= '
                                                                                    'self.update_mla_kv_caches(\n'
                                                                                    '            '
                                                                                    'low_rank_main, '
                                                                                    'key_rope, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk\n'
                                                                                    '        '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'cached_values\n'
                                                                                    '\n'
                                                                                    '  '
                                                                                    'def '
                                                                                    '__call__(\n'
                                                                                    '      '
                                                                                    'self,\n'
                                                                                    '      '
                                                                                    'inputs_q: '
                                                                                    'Array,\n'
                                                                                    '      '
                                                                                    'inputs_kv: '
                                                                                    'Array,\n'
                                                                                    '      '
                                                                                    'inputs_positions: '
                                                                                    'Array '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'decoder_segment_ids: '
                                                                                    'Array '
                                                                                    '| '
                                                                                    'None '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    '*,\n'
                                                                                    '      '
                                                                                    'model_mode: '
                                                                                    'str '
                                                                                    '= '
                                                                                    'MODEL_MODE_TRAIN,\n'
                                                                                    '      '
                                                                                    'deterministic: '
                                                                                    'bool '
                                                                                    '= '
                                                                                    'False,\n'
                                                                                    '      '
                                                                                    'previous_chunk: '
                                                                                    'Any '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'slot: '
                                                                                    'Optional[int] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'page_state: '
                                                                                    'Optional[page_manager.PageState] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '      '
                                                                                    'bidirectional_mask: '
                                                                                    'Optional[Any] '
                                                                                    '= '
                                                                                    'None,\n'
                                                                                    '  '
                                                                                    ') '
                                                                                    '-> '
                                                                                    'Array:\n'
                                                                                    '    '
                                                                                    '"""Forward '
                                                                                    'pass '
                                                                                    'for '
                                                                                    'MLA, '
                                                                                    'reusing '
                                                                                    '`AttentionOp` '
                                                                                    'for '
                                                                                    'the '
                                                                                    'actual '
                                                                                    'attention.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Args:\n'
                                                                                    '      '
                                                                                    'inputs_q: '
                                                                                    'Query '
                                                                                    'input '
                                                                                    '[batch, '
                                                                                    'q_length, '
                                                                                    'embed_dim].\n'
                                                                                    '      '
                                                                                    'inputs_kv: '
                                                                                    'KV '
                                                                                    'input   '
                                                                                    '[batch, '
                                                                                    'kv_length, '
                                                                                    'embed_dim].\n'
                                                                                    '      '
                                                                                    'inputs_positions: '
                                                                                    'Positions '
                                                                                    'for '
                                                                                    'rotary '
                                                                                    'embeddings '
                                                                                    'or '
                                                                                    'similar.\n'
                                                                                    '      '
                                                                                    'decoder_segment_ids: '
                                                                                    'Segment '
                                                                                    'IDs '
                                                                                    'for '
                                                                                    'masking, '
                                                                                    'if '
                                                                                    'any.\n'
                                                                                    '      '
                                                                                    'model_mode: '
                                                                                    '"train", '
                                                                                    '"prefill", '
                                                                                    'or '
                                                                                    '"autoregressive".\n'
                                                                                    '      '
                                                                                    'deterministic: '
                                                                                    'Disables '
                                                                                    'dropout '
                                                                                    'if '
                                                                                    'set '
                                                                                    'to '
                                                                                    'True.\n'
                                                                                    '      '
                                                                                    'previous_chunk: '
                                                                                    'Information '
                                                                                    'about '
                                                                                    'previously '
                                                                                    'processed '
                                                                                    'chunks '
                                                                                    'for '
                                                                                    'chunked '
                                                                                    'prefill.\n'
                                                                                    '      '
                                                                                    'slot: '
                                                                                    'The '
                                                                                    'batch '
                                                                                    'slot '
                                                                                    'index '
                                                                                    'for '
                                                                                    'paged '
                                                                                    'attention.\n'
                                                                                    '      '
                                                                                    'page_state: '
                                                                                    'The '
                                                                                    'current '
                                                                                    'state '
                                                                                    'of '
                                                                                    'the '
                                                                                    'paged '
                                                                                    'attention '
                                                                                    'manager.\n'
                                                                                    '      '
                                                                                    'bidirectional_mask: '
                                                                                    'A '
                                                                                    'mask '
                                                                                    'for '
                                                                                    'bidirectional '
                                                                                    'attention, '
                                                                                    'used '
                                                                                    'in '
                                                                                    'multimodal '
                                                                                    'models.\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'Returns:\n'
                                                                                    '      '
                                                                                    'A '
                                                                                    'tensor '
                                                                                    'of '
                                                                                    'shape '
                                                                                    '[batch, '
                                                                                    'length, '
                                                                                    'embed_dim] '
                                                                                    'containing '
                                                                                    'the\n'
                                                                                    '      '
                                                                                    'MLA-attended '
                                                                                    'outputs.\n'
                                                                                    '    '
                                                                                    '"""\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_PREFILL:\n'
                                                                                    '      '
                                                                                    'inputs_q '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_q, '
                                                                                    'self.prefill_input_axis_names)\n'
                                                                                    '      '
                                                                                    'inputs_kv '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_kv, '
                                                                                    'self.prefill_input_axis_names)\n'
                                                                                    '    '
                                                                                    'elif '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_TRAIN '
                                                                                    'and '
                                                                                    'self.config.expert_shard_attention_option '
                                                                                    '== '
                                                                                    'EP_AS_CONTEXT:\n'
                                                                                    '      '
                                                                                    'inputs_q '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_q, '
                                                                                    'self.ep_input_axis_names)\n'
                                                                                    '      '
                                                                                    'inputs_kv '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_kv, '
                                                                                    'self.ep_input_axis_names)\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'inputs_q '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_q, '
                                                                                    'self.input_axis_names)\n'
                                                                                    '      '
                                                                                    'inputs_kv '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(inputs_kv, '
                                                                                    'self.input_axis_names)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'query '
                                                                                    '= '
                                                                                    'self.mla_query_projection(inputs_q, '
                                                                                    'inputs_positions, '
                                                                                    'model_mode)\n'
                                                                                    '    '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'cached_values '
                                                                                    '= '
                                                                                    'self.mla_kv_projection(\n'
                                                                                    '        '
                                                                                    'inputs_kv, '
                                                                                    'inputs_positions, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk\n'
                                                                                    '    '
                                                                                    ')\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'query '
                                                                                    '= '
                                                                                    'checkpoint_name(query, '
                                                                                    '"query_proj")\n'
                                                                                    '    '
                                                                                    'key '
                                                                                    '= '
                                                                                    'checkpoint_name(key, '
                                                                                    '"key_proj")\n'
                                                                                    '    '
                                                                                    'value '
                                                                                    '= '
                                                                                    'checkpoint_name(value, '
                                                                                    '"value_proj")\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'self.config.attention '
                                                                                    '== '
                                                                                    '"paged" '
                                                                                    'and '
                                                                                    'model_mode '
                                                                                    '!= '
                                                                                    'MODEL_MODE_TRAIN:\n'
                                                                                    '      '
                                                                                    'unnormalized_out, '
                                                                                    '_, '
                                                                                    'exp_sum '
                                                                                    '= '
                                                                                    'self.ds_paged_attention_op(\n'
                                                                                    '          '
                                                                                    'query, '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'previous_chunk, '
                                                                                    'slot=slot, '
                                                                                    'page_state=page_state\n'
                                                                                    '      '
                                                                                    ')\n'
                                                                                    '      '
                                                                                    'unnormalized_out '
                                                                                    '= '
                                                                                    'unnormalized_out[..., '
                                                                                    ': '
                                                                                    'self.v_head_dim]\n'
                                                                                    '      '
                                                                                    'out '
                                                                                    '= '
                                                                                    'unnormalized_out '
                                                                                    '/ '
                                                                                    '(exp_sum '
                                                                                    '+ '
                                                                                    '1e-9) '
                                                                                    'if '
                                                                                    'exp_sum '
                                                                                    'is '
                                                                                    'not '
                                                                                    'None '
                                                                                    'else '
                                                                                    'unnormalized_out\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'out '
                                                                                    '= '
                                                                                    'self.attention_op(query, '
                                                                                    'key, '
                                                                                    'value, '
                                                                                    'decoder_segment_ids, '
                                                                                    'model_mode, '
                                                                                    'cached_values)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'if '
                                                                                    'model_mode '
                                                                                    '== '
                                                                                    'MODEL_MODE_TRAIN '
                                                                                    'and '
                                                                                    'self.config.expert_shard_attention_option '
                                                                                    '== '
                                                                                    'EP_AS_CONTEXT:\n'
                                                                                    '      '
                                                                                    'out '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(out, '
                                                                                    'self.ep_out_axis_names)\n'
                                                                                    '    '
                                                                                    'else:\n'
                                                                                    '      '
                                                                                    'out '
                                                                                    '= '
                                                                                    'nn.with_logical_constraint(out, '
                                                                                    'self.out_axis_names)\n'
                                                                                    '\n'
                                                                                    '    '
                                                                                    'out '
                                                                                    '= '
                                                                                    'self.out_projection(out)\n'
                                                                                    '    '
                                                                                    'return '
                                                                                    'out'],
                                                                                   [0.0,
                                                                                    'MaxText/layers/attention_op.py#validate_compute_axis_order',
                                                                                    'MaxText/layers/attention_op.py',
                                                                                    'def '
                                                                                    'validate_compute_axis_order(s: '
                                                                                    'AxisIdxes) '
                                                                                    '-> '
                                                                                    'None:\n'
                                                                                    '  '
                                                                                    'valid_compute_axis_order '
                                                                                    '= '
                                                                                    '((0, '
                                                                                    '1, '
                                                                                    '2, '
                                                                                    '3), '
                                                                                    '(0, '
                                                                                    '2, '
                                                                                    '1, '
                                                                                    '3))\n'
                                                                                    '  '
                                                                                    'if '
                                                                                    's '
                                                                                    'not '
                                                                                    'in '
                                                                                    'valid_compute_axis_order:  '
                                                                                    '# '
                                                                                    'currently '
                                                                                    'supported '
                                                                                    'compute_axis_order\n'
                                                                                    '    '
                                                                                    'raise '
                                                                                    'ValueError("Invalid '
                                                                                    'compute_axis_order '
                                                                                    'was '
                                                                                    'passed. '
                                                                                    'Valid '
                                                                                    'options '
                                                                                    '", '
                                                                                    'valid_compute_axis_order)']],
                      'transformers/utils/import_utils.py#FAISS_IMPORT_ERROR': [[0.0,
                                                                                 'MaxText/layers/attention_mla.py#mla_as_linen',
                                                                                 'MaxText/layers/attention_mla.py',
                                                                                 'def '
                                                                                 'mla_as_linen(\n'
                                                                                 '    '
                                                                                 '*,\n'
                                                                                 '    '
                                                                                 'config: '
                                                                                 'Config,\n'
                                                                                 '    '
                                                                                 'num_query_heads: '
                                                                                 'int,\n'
                                                                                 '    '
                                                                                 'num_kv_heads: '
                                                                                 'int,\n'
                                                                                 '    '
                                                                                 'head_dim: '
                                                                                 'int,\n'
                                                                                 '    '
                                                                                 'max_target_length: '
                                                                                 'int,\n'
                                                                                 '    '
                                                                                 'mesh: '
                                                                                 'Mesh,\n'
                                                                                 '    '
                                                                                 'attention_kernel: '
                                                                                 'str,\n'
                                                                                 '    '
                                                                                 'inputs_q_shape: '
                                                                                 'Tuple,\n'
                                                                                 '    '
                                                                                 'inputs_kv_shape: '
                                                                                 'Tuple,\n'
                                                                                 '    '
                                                                                 'dtype: '
                                                                                 'DType '
                                                                                 '= '
                                                                                 'jnp.float32,\n'
                                                                                 '    '
                                                                                 'weight_dtype: '
                                                                                 'DType '
                                                                                 '= '
                                                                                 'jnp.float32,\n'
                                                                                 '    '
                                                                                 'max_prefill_predict_length: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '-1,\n'
                                                                                 '    '
                                                                                 'dropout_rate: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '0.0,\n'
                                                                                 '    '
                                                                                 'kernel_init: '
                                                                                 'NdInitializer '
                                                                                 '= '
                                                                                 'nd_dense_init(1.0, '
                                                                                 '"fan_in", '
                                                                                 '"normal"),\n'
                                                                                 '    '
                                                                                 'float32_qk_product: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'computes '
                                                                                 'logits '
                                                                                 'in '
                                                                                 'float32 '
                                                                                 'for '
                                                                                 'stability.\n'
                                                                                 '    '
                                                                                 'float32_logits: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'cast '
                                                                                 'logits '
                                                                                 'in '
                                                                                 'float32 '
                                                                                 'for '
                                                                                 'stability.\n'
                                                                                 '    '
                                                                                 'quant: '
                                                                                 'Optional[Quant] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '    '
                                                                                 'kv_quant: '
                                                                                 'Optional[KVQuant] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '    '
                                                                                 'attention_type: '
                                                                                 'AttentionType '
                                                                                 '= '
                                                                                 'AttentionType.GLOBAL,  '
                                                                                 '# '
                                                                                 'Default '
                                                                                 'to '
                                                                                 'global '
                                                                                 'attention\n'
                                                                                 '    '
                                                                                 'attn_logits_soft_cap: '
                                                                                 'float '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '    '
                                                                                 'sliding_window_size: '
                                                                                 'int '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '    '
                                                                                 'use_ragged_attention: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'ragged_block_size: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '256,\n'
                                                                                 '    '
                                                                                 'use_qk_norm: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'query_pre_attn_scalar: '
                                                                                 'float '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '    '
                                                                                 'use_bias_in_projections: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'Set '
                                                                                 'to '
                                                                                 'True '
                                                                                 'will '
                                                                                 'enable '
                                                                                 'bias '
                                                                                 'in '
                                                                                 'q, '
                                                                                 'k, '
                                                                                 'v, '
                                                                                 'o '
                                                                                 'projections\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Temperature '
                                                                                 'tuning '
                                                                                 'parameters '
                                                                                 'used '
                                                                                 'for '
                                                                                 'Llama4\n'
                                                                                 '    '
                                                                                 'temperature_tuning: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'temperature_tuning_scale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '0.1,\n'
                                                                                 '    '
                                                                                 'temperature_tuning_floor_scale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '8192.0,\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Shard '
                                                                                 'the '
                                                                                 'query '
                                                                                 'activation '
                                                                                 'as '
                                                                                 'the '
                                                                                 'same '
                                                                                 'as '
                                                                                 'the '
                                                                                 'key '
                                                                                 'and '
                                                                                 'value.\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'TODO: '
                                                                                 'Find '
                                                                                 'a '
                                                                                 'better '
                                                                                 'sharding '
                                                                                 'axis '
                                                                                 'name.\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'TODO: '
                                                                                 'Further '
                                                                                 'break '
                                                                                 'down '
                                                                                 'the '
                                                                                 'Training '
                                                                                 'and '
                                                                                 'Inference '
                                                                                 'axes '
                                                                                 'for '
                                                                                 'the '
                                                                                 'q, '
                                                                                 'k, '
                                                                                 'v.\n'
                                                                                 '    '
                                                                                 'prefill_query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'prefill_key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'prefill_value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'ep_query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'ep_key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'ep_value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '    '
                                                                                 'input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'EMBED),\n'
                                                                                 '    '
                                                                                 'ep_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '    '
                                                                                 'out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '    '
                                                                                 'ep_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '    '
                                                                                 'prefill_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '    '
                                                                                 'decode_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(DECODE_BATCH, '
                                                                                 'DECODE_LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '    '
                                                                                 'prefill_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '    '
                                                                                 'decode_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(DECODE_BATCH, '
                                                                                 'DECODE_LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '    '
                                                                                 'prefill_cache_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(1, '
                                                                                 '2, '
                                                                                 '0, '
                                                                                 '3),\n'
                                                                                 '    '
                                                                                 'ar_cache_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(1, '
                                                                                 '2, '
                                                                                 '0, '
                                                                                 '3),\n'
                                                                                 '    '
                                                                                 'compute_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(0, '
                                                                                 '1, '
                                                                                 '2, '
                                                                                 '3),\n'
                                                                                 '    '
                                                                                 'reshape_q: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'is_nope_layer: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'is_vision: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '    '
                                                                                 'model_mode: '
                                                                                 'str '
                                                                                 '= '
                                                                                 'MODEL_MODE_TRAIN,\n'
                                                                                 '    '
                                                                                 'q_lora_rank: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '0,\n'
                                                                                 '    '
                                                                                 'kv_lora_rank: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '512,\n'
                                                                                 '    '
                                                                                 'qk_nope_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '128,\n'
                                                                                 '    '
                                                                                 'qk_rope_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '64,\n'
                                                                                 '    '
                                                                                 'v_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '128,\n'
                                                                                 '    '
                                                                                 'max_position_embeddings: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '4096 '
                                                                                 '* '
                                                                                 '4,\n'
                                                                                 '    '
                                                                                 'original_max_position_embeddings: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '4096,\n'
                                                                                 '    '
                                                                                 'mscale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '1.0,  '
                                                                                 '# '
                                                                                 'scaling '
                                                                                 'factor '
                                                                                 'for '
                                                                                 'softmax\n'
                                                                                 '    '
                                                                                 'rope_factor: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '40.0,  '
                                                                                 '# '
                                                                                 'rotary '
                                                                                 'embedding '
                                                                                 'factor\n'
                                                                                 '    '
                                                                                 'name: '
                                                                                 'str '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '):\n'
                                                                                 '  '
                                                                                 '"""A '
                                                                                 'factory '
                                                                                 'function '
                                                                                 'to '
                                                                                 'create '
                                                                                 'an '
                                                                                 'MLA '
                                                                                 'as '
                                                                                 'a '
                                                                                 'Linen '
                                                                                 'module.\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'This '
                                                                                 'function '
                                                                                 'serves '
                                                                                 'as '
                                                                                 'a '
                                                                                 'bridge '
                                                                                 'to '
                                                                                 'use '
                                                                                 'the '
                                                                                 'NNX-based '
                                                                                 '`MLA` '
                                                                                 'within '
                                                                                 'a\n'
                                                                                 '  '
                                                                                 'Linen '
                                                                                 'model.\n'
                                                                                 '  '
                                                                                 '"""\n'
                                                                                 '  '
                                                                                 'return '
                                                                                 'nnx_wrappers.to_linen(\n'
                                                                                 '      '
                                                                                 'MLA,\n'
                                                                                 '      '
                                                                                 'config=config,\n'
                                                                                 '      '
                                                                                 'num_query_heads=num_query_heads,\n'
                                                                                 '      '
                                                                                 'num_kv_heads=num_kv_heads,\n'
                                                                                 '      '
                                                                                 'head_dim=head_dim,\n'
                                                                                 '      '
                                                                                 'max_target_length=max_target_length,\n'
                                                                                 '      '
                                                                                 'mesh=mesh,\n'
                                                                                 '      '
                                                                                 'attention_kernel=attention_kernel,\n'
                                                                                 '      '
                                                                                 'inputs_q_shape=inputs_q_shape,\n'
                                                                                 '      '
                                                                                 'inputs_kv_shape=inputs_kv_shape,\n'
                                                                                 '      '
                                                                                 'dtype=dtype,\n'
                                                                                 '      '
                                                                                 'weight_dtype=weight_dtype,\n'
                                                                                 '      '
                                                                                 'max_prefill_predict_length=max_prefill_predict_length,\n'
                                                                                 '      '
                                                                                 'dropout_rate=dropout_rate,\n'
                                                                                 '      '
                                                                                 'kernel_init=kernel_init,\n'
                                                                                 '      '
                                                                                 'float32_qk_product=float32_qk_product,\n'
                                                                                 '      '
                                                                                 'float32_logits=float32_logits,\n'
                                                                                 '      '
                                                                                 'quant=quant,\n'
                                                                                 '      '
                                                                                 'kv_quant=kv_quant,\n'
                                                                                 '      '
                                                                                 'attention_type=attention_type,\n'
                                                                                 '      '
                                                                                 'attn_logits_soft_cap=attn_logits_soft_cap,\n'
                                                                                 '      '
                                                                                 'sliding_window_size=sliding_window_size,\n'
                                                                                 '      '
                                                                                 'use_ragged_attention=use_ragged_attention,\n'
                                                                                 '      '
                                                                                 'ragged_block_size=ragged_block_size,\n'
                                                                                 '      '
                                                                                 'use_qk_norm=use_qk_norm,\n'
                                                                                 '      '
                                                                                 'query_pre_attn_scalar=query_pre_attn_scalar,\n'
                                                                                 '      '
                                                                                 'use_bias_in_projections=use_bias_in_projections,\n'
                                                                                 '      '
                                                                                 'temperature_tuning=temperature_tuning,\n'
                                                                                 '      '
                                                                                 'temperature_tuning_scale=temperature_tuning_scale,\n'
                                                                                 '      '
                                                                                 'temperature_tuning_floor_scale=temperature_tuning_floor_scale,\n'
                                                                                 '      '
                                                                                 'prefill_query_axis_names=prefill_query_axis_names,\n'
                                                                                 '      '
                                                                                 'prefill_key_axis_names=prefill_key_axis_names,\n'
                                                                                 '      '
                                                                                 'prefill_value_axis_names=prefill_value_axis_names,\n'
                                                                                 '      '
                                                                                 'query_axis_names=query_axis_names,\n'
                                                                                 '      '
                                                                                 'key_axis_names=key_axis_names,\n'
                                                                                 '      '
                                                                                 'value_axis_names=value_axis_names,\n'
                                                                                 '      '
                                                                                 'ep_query_axis_names=ep_query_axis_names,\n'
                                                                                 '      '
                                                                                 'ep_key_axis_names=ep_key_axis_names,\n'
                                                                                 '      '
                                                                                 'ep_value_axis_names=ep_value_axis_names,\n'
                                                                                 '      '
                                                                                 'input_axis_names=input_axis_names,\n'
                                                                                 '      '
                                                                                 'ep_input_axis_names=ep_input_axis_names,\n'
                                                                                 '      '
                                                                                 'out_axis_names=out_axis_names,\n'
                                                                                 '      '
                                                                                 'ep_out_axis_names=ep_out_axis_names,\n'
                                                                                 '      '
                                                                                 'prefill_input_axis_names=prefill_input_axis_names,\n'
                                                                                 '      '
                                                                                 'decode_input_axis_names=decode_input_axis_names,\n'
                                                                                 '      '
                                                                                 'prefill_out_axis_names=prefill_out_axis_names,\n'
                                                                                 '      '
                                                                                 'decode_out_axis_names=decode_out_axis_names,\n'
                                                                                 '      '
                                                                                 'prefill_cache_axis_order=prefill_cache_axis_order,\n'
                                                                                 '      '
                                                                                 'ar_cache_axis_order=ar_cache_axis_order,\n'
                                                                                 '      '
                                                                                 'compute_axis_order=compute_axis_order,\n'
                                                                                 '      '
                                                                                 'reshape_q=reshape_q,\n'
                                                                                 '      '
                                                                                 'is_nope_layer=is_nope_layer,\n'
                                                                                 '      '
                                                                                 'is_vision=is_vision,\n'
                                                                                 '      '
                                                                                 'model_mode=model_mode,\n'
                                                                                 '      '
                                                                                 'q_lora_rank=q_lora_rank,\n'
                                                                                 '      '
                                                                                 'kv_lora_rank=kv_lora_rank,\n'
                                                                                 '      '
                                                                                 'qk_nope_head_dim=qk_nope_head_dim,\n'
                                                                                 '      '
                                                                                 'qk_rope_head_dim=qk_rope_head_dim,\n'
                                                                                 '      '
                                                                                 'v_head_dim=v_head_dim,\n'
                                                                                 '      '
                                                                                 'max_position_embeddings=max_position_embeddings,\n'
                                                                                 '      '
                                                                                 'original_max_position_embeddings=original_max_position_embeddings,\n'
                                                                                 '      '
                                                                                 'mscale=mscale,\n'
                                                                                 '      '
                                                                                 'rope_factor=rope_factor,\n'
                                                                                 '      '
                                                                                 'name=name,\n'
                                                                                 '      '
                                                                                 'metadata_fn=variable_to_logically_partitioned,\n'
                                                                                 '      '
                                                                                 'abstract_init=False,\n'
                                                                                 '  '
                                                                                 ')'],
                                                                                [0.0,
                                                                                 'MaxText/layers/attention_mla.py#MLA',
                                                                                 'MaxText/layers/attention_mla.py',
                                                                                 'class '
                                                                                 'MLA(Attention):\n'
                                                                                 '  '
                                                                                 '"""Multi-Head '
                                                                                 'Latent '
                                                                                 'Attention '
                                                                                 '(MLA) '
                                                                                 'layer."""\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 '__init__(\n'
                                                                                 '      '
                                                                                 'self,\n'
                                                                                 '      '
                                                                                 'config: '
                                                                                 'Config,\n'
                                                                                 '      '
                                                                                 'num_query_heads: '
                                                                                 'int,\n'
                                                                                 '      '
                                                                                 'num_kv_heads: '
                                                                                 'int,\n'
                                                                                 '      '
                                                                                 'head_dim: '
                                                                                 'int,\n'
                                                                                 '      '
                                                                                 'max_target_length: '
                                                                                 'int,\n'
                                                                                 '      '
                                                                                 'mesh: '
                                                                                 'Mesh,\n'
                                                                                 '      '
                                                                                 'attention_kernel: '
                                                                                 'str,\n'
                                                                                 '      '
                                                                                 'inputs_q_shape: '
                                                                                 'Tuple,\n'
                                                                                 '      '
                                                                                 'inputs_kv_shape: '
                                                                                 'Tuple,\n'
                                                                                 '      '
                                                                                 'dtype: '
                                                                                 'DType '
                                                                                 '= '
                                                                                 'jnp.float32,\n'
                                                                                 '      '
                                                                                 'weight_dtype: '
                                                                                 'DType '
                                                                                 '= '
                                                                                 'jnp.float32,\n'
                                                                                 '      '
                                                                                 'max_prefill_predict_length: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '-1,\n'
                                                                                 '      '
                                                                                 'dropout_rate: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '0.0,\n'
                                                                                 '      '
                                                                                 'kernel_init: '
                                                                                 'NdInitializer '
                                                                                 '= '
                                                                                 'nd_dense_init(1.0, '
                                                                                 '"fan_in", '
                                                                                 '"normal"),\n'
                                                                                 '      '
                                                                                 'float32_qk_product: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'computes '
                                                                                 'logits '
                                                                                 'in '
                                                                                 'float32 '
                                                                                 'for '
                                                                                 'stability.\n'
                                                                                 '      '
                                                                                 'float32_logits: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'cast '
                                                                                 'logits '
                                                                                 'in '
                                                                                 'float32 '
                                                                                 'for '
                                                                                 'stability.\n'
                                                                                 '      '
                                                                                 'quant: '
                                                                                 'Optional[Quant] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'kv_quant: '
                                                                                 'Optional[KVQuant] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'attention_type: '
                                                                                 'AttentionType '
                                                                                 '= '
                                                                                 'AttentionType.GLOBAL,  '
                                                                                 '# '
                                                                                 'Default '
                                                                                 'to '
                                                                                 'global '
                                                                                 'attention\n'
                                                                                 '      '
                                                                                 'attn_logits_soft_cap: '
                                                                                 'float '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'sliding_window_size: '
                                                                                 'int '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'use_ragged_attention: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'ragged_block_size: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '256,\n'
                                                                                 '      '
                                                                                 'use_qk_norm: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'query_pre_attn_scalar: '
                                                                                 'float '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'use_bias_in_projections: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,  '
                                                                                 '# '
                                                                                 'Set '
                                                                                 'to '
                                                                                 'True '
                                                                                 'will '
                                                                                 'enable '
                                                                                 'bias '
                                                                                 'in '
                                                                                 'q, '
                                                                                 'k, '
                                                                                 'v, '
                                                                                 'o '
                                                                                 'projections\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'Temperature '
                                                                                 'tuning '
                                                                                 'parameters '
                                                                                 'used '
                                                                                 'for '
                                                                                 'Llama4\n'
                                                                                 '      '
                                                                                 'temperature_tuning: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'temperature_tuning_scale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '0.1,\n'
                                                                                 '      '
                                                                                 'temperature_tuning_floor_scale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '8192.0,\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'Shard '
                                                                                 'the '
                                                                                 'query '
                                                                                 'activation '
                                                                                 'as '
                                                                                 'the '
                                                                                 'same '
                                                                                 'as '
                                                                                 'the '
                                                                                 'key '
                                                                                 'and '
                                                                                 'value.\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'TODO: '
                                                                                 'Find '
                                                                                 'a '
                                                                                 'better '
                                                                                 'sharding '
                                                                                 'axis '
                                                                                 'name.\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'TODO: '
                                                                                 'Further '
                                                                                 'break '
                                                                                 'down '
                                                                                 'the '
                                                                                 'Training '
                                                                                 'and '
                                                                                 'Inference '
                                                                                 'axes '
                                                                                 'for '
                                                                                 'the '
                                                                                 'q, '
                                                                                 'k, '
                                                                                 'v.\n'
                                                                                 '      '
                                                                                 'prefill_query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'prefill_key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'prefill_value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'ep_query_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'ep_key_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'ep_value_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(KV_BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'KV_HEAD, '
                                                                                 'KV_HEAD_DIM),\n'
                                                                                 '      '
                                                                                 'input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'EMBED),\n'
                                                                                 '      '
                                                                                 'ep_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '      '
                                                                                 'out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH, '
                                                                                 'LENGTH_NO_EXP, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '      '
                                                                                 'ep_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(BATCH_NO_EXP, '
                                                                                 'LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '      '
                                                                                 'prefill_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '      '
                                                                                 'decode_input_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(DECODE_BATCH, '
                                                                                 'DECODE_LENGTH, '
                                                                                 'EMBED),\n'
                                                                                 '      '
                                                                                 'prefill_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(PREFILL_KV_BATCH, '
                                                                                 'PREFILL_LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '      '
                                                                                 'decode_out_axis_names: '
                                                                                 'AxisNames '
                                                                                 '= '
                                                                                 '(DECODE_BATCH, '
                                                                                 'DECODE_LENGTH, '
                                                                                 'HEAD, '
                                                                                 'D_KV),\n'
                                                                                 '      '
                                                                                 'prefill_cache_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(1, '
                                                                                 '2, '
                                                                                 '0, '
                                                                                 '3),\n'
                                                                                 '      '
                                                                                 'ar_cache_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(1, '
                                                                                 '2, '
                                                                                 '0, '
                                                                                 '3),\n'
                                                                                 '      '
                                                                                 'compute_axis_order: '
                                                                                 'AxisIdxes '
                                                                                 '= '
                                                                                 '(0, '
                                                                                 '1, '
                                                                                 '2, '
                                                                                 '3),\n'
                                                                                 '      '
                                                                                 'reshape_q: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'is_nope_layer: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'is_vision: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'model_mode: '
                                                                                 'str '
                                                                                 '= '
                                                                                 'MODEL_MODE_TRAIN,\n'
                                                                                 '      '
                                                                                 'q_lora_rank: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '0,\n'
                                                                                 '      '
                                                                                 'kv_lora_rank: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '512,\n'
                                                                                 '      '
                                                                                 'qk_nope_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '128,\n'
                                                                                 '      '
                                                                                 'qk_rope_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '64,\n'
                                                                                 '      '
                                                                                 'v_head_dim: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '128,\n'
                                                                                 '      '
                                                                                 'max_position_embeddings: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '4096 '
                                                                                 '* '
                                                                                 '4,\n'
                                                                                 '      '
                                                                                 'original_max_position_embeddings: '
                                                                                 'int '
                                                                                 '= '
                                                                                 '4096,\n'
                                                                                 '      '
                                                                                 'mscale: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '1.0,  '
                                                                                 '# '
                                                                                 'scaling '
                                                                                 'factor '
                                                                                 'for '
                                                                                 'softmax\n'
                                                                                 '      '
                                                                                 'rope_factor: '
                                                                                 'float '
                                                                                 '= '
                                                                                 '40.0,  '
                                                                                 '# '
                                                                                 'rotary '
                                                                                 'embedding '
                                                                                 'factor\n'
                                                                                 '      '
                                                                                 'name: '
                                                                                 'str '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'rngs: '
                                                                                 'Optional[nnx.Rngs] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '  '
                                                                                 '):\n'
                                                                                 '    '
                                                                                 '"""Initializes '
                                                                                 'the '
                                                                                 'MLA '
                                                                                 'module.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Args:\n'
                                                                                 '      '
                                                                                 'config: '
                                                                                 'The '
                                                                                 'model '
                                                                                 'configuration.\n'
                                                                                 '      '
                                                                                 '... '
                                                                                 'and '
                                                                                 'other '
                                                                                 'configuration '
                                                                                 'parameters '
                                                                                 'for '
                                                                                 'MLA '
                                                                                 'attention.\n'
                                                                                 '      '
                                                                                 'rngs: '
                                                                                 'The '
                                                                                 'random '
                                                                                 'number '
                                                                                 'generators '
                                                                                 'for '
                                                                                 'initialization, '
                                                                                 'passed '
                                                                                 'by '
                                                                                 'the '
                                                                                 'nnx.to_linen '
                                                                                 'wrapper.\n'
                                                                                 '    '
                                                                                 '"""\n'
                                                                                 '    '
                                                                                 'base_kv_cache '
                                                                                 '= '
                                                                                 'config.attention '
                                                                                 '!= '
                                                                                 '"paged" '
                                                                                 'and '
                                                                                 'config.mla_naive_kvcache\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Setting '
                                                                                 'these '
                                                                                 'before '
                                                                                 'call '
                                                                                 'to '
                                                                                 'super '
                                                                                 'because '
                                                                                 'a '
                                                                                 'field '
                                                                                 'is '
                                                                                 'used '
                                                                                 'in '
                                                                                 'super\n'
                                                                                 '    '
                                                                                 'self.q_lora_rank '
                                                                                 '= '
                                                                                 'q_lora_rank\n'
                                                                                 '    '
                                                                                 'self.kv_lora_rank '
                                                                                 '= '
                                                                                 'kv_lora_rank\n'
                                                                                 '    '
                                                                                 'self.qk_nope_head_dim '
                                                                                 '= '
                                                                                 'qk_nope_head_dim\n'
                                                                                 '    '
                                                                                 'self.qk_rope_head_dim '
                                                                                 '= '
                                                                                 'qk_rope_head_dim\n'
                                                                                 '    '
                                                                                 'self.v_head_dim '
                                                                                 '= '
                                                                                 'v_head_dim\n'
                                                                                 '    '
                                                                                 'self.max_position_embeddings '
                                                                                 '= '
                                                                                 'max_position_embeddings\n'
                                                                                 '    '
                                                                                 'self.original_max_position_embeddings '
                                                                                 '= '
                                                                                 'original_max_position_embeddings\n'
                                                                                 '    '
                                                                                 'self.mscale '
                                                                                 '= '
                                                                                 'mscale\n'
                                                                                 '    '
                                                                                 'self.rope_factor '
                                                                                 '= '
                                                                                 'rope_factor\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'self.qk_head_dim '
                                                                                 '= '
                                                                                 'self.qk_nope_head_dim '
                                                                                 '+ '
                                                                                 'self.qk_rope_head_dim\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'super().__init__(\n'
                                                                                 '        '
                                                                                 'config=config,\n'
                                                                                 '        '
                                                                                 'num_query_heads=num_query_heads,\n'
                                                                                 '        '
                                                                                 'num_kv_heads=num_kv_heads,\n'
                                                                                 '        '
                                                                                 'head_dim=head_dim,\n'
                                                                                 '        '
                                                                                 'max_target_length=max_target_length,\n'
                                                                                 '        '
                                                                                 'mesh=mesh,\n'
                                                                                 '        '
                                                                                 'attention_kernel=attention_kernel,\n'
                                                                                 '        '
                                                                                 'inputs_q_shape=inputs_q_shape,\n'
                                                                                 '        '
                                                                                 'inputs_kv_shape=inputs_kv_shape,\n'
                                                                                 '        '
                                                                                 'dtype=dtype,\n'
                                                                                 '        '
                                                                                 'weight_dtype=weight_dtype,\n'
                                                                                 '        '
                                                                                 'max_prefill_predict_length=max_prefill_predict_length,\n'
                                                                                 '        '
                                                                                 'dropout_rate=dropout_rate,\n'
                                                                                 '        '
                                                                                 'kernel_init=kernel_init,\n'
                                                                                 '        '
                                                                                 'float32_qk_product=float32_qk_product,\n'
                                                                                 '        '
                                                                                 'float32_logits=float32_logits,\n'
                                                                                 '        '
                                                                                 'quant=quant,\n'
                                                                                 '        '
                                                                                 'kv_quant=kv_quant,\n'
                                                                                 '        '
                                                                                 'attention_type=attention_type,\n'
                                                                                 '        '
                                                                                 'attn_logits_soft_cap=attn_logits_soft_cap,\n'
                                                                                 '        '
                                                                                 'sliding_window_size=sliding_window_size,\n'
                                                                                 '        '
                                                                                 'use_ragged_attention=use_ragged_attention,\n'
                                                                                 '        '
                                                                                 'ragged_block_size=ragged_block_size,\n'
                                                                                 '        '
                                                                                 'use_qk_norm=use_qk_norm,\n'
                                                                                 '        '
                                                                                 'query_pre_attn_scalar=query_pre_attn_scalar,\n'
                                                                                 '        '
                                                                                 'use_bias_in_projections=use_bias_in_projections,\n'
                                                                                 '        '
                                                                                 'temperature_tuning=temperature_tuning,\n'
                                                                                 '        '
                                                                                 'temperature_tuning_scale=temperature_tuning_scale,\n'
                                                                                 '        '
                                                                                 'temperature_tuning_floor_scale=temperature_tuning_floor_scale,\n'
                                                                                 '        '
                                                                                 'prefill_query_axis_names=prefill_query_axis_names,\n'
                                                                                 '        '
                                                                                 'prefill_key_axis_names=prefill_key_axis_names,\n'
                                                                                 '        '
                                                                                 'prefill_value_axis_names=prefill_value_axis_names,\n'
                                                                                 '        '
                                                                                 'query_axis_names=query_axis_names,\n'
                                                                                 '        '
                                                                                 'key_axis_names=key_axis_names,\n'
                                                                                 '        '
                                                                                 'value_axis_names=value_axis_names,\n'
                                                                                 '        '
                                                                                 'ep_query_axis_names=ep_query_axis_names,\n'
                                                                                 '        '
                                                                                 'ep_key_axis_names=ep_key_axis_names,\n'
                                                                                 '        '
                                                                                 'ep_value_axis_names=ep_value_axis_names,\n'
                                                                                 '        '
                                                                                 'input_axis_names=input_axis_names,\n'
                                                                                 '        '
                                                                                 'ep_input_axis_names=ep_input_axis_names,\n'
                                                                                 '        '
                                                                                 'out_axis_names=out_axis_names,\n'
                                                                                 '        '
                                                                                 'ep_out_axis_names=ep_out_axis_names,\n'
                                                                                 '        '
                                                                                 'prefill_input_axis_names=prefill_input_axis_names,\n'
                                                                                 '        '
                                                                                 'decode_input_axis_names=decode_input_axis_names,\n'
                                                                                 '        '
                                                                                 'prefill_out_axis_names=prefill_out_axis_names,\n'
                                                                                 '        '
                                                                                 'decode_out_axis_names=decode_out_axis_names,\n'
                                                                                 '        '
                                                                                 'prefill_cache_axis_order=prefill_cache_axis_order,\n'
                                                                                 '        '
                                                                                 'ar_cache_axis_order=ar_cache_axis_order,\n'
                                                                                 '        '
                                                                                 'compute_axis_order=compute_axis_order,\n'
                                                                                 '        '
                                                                                 'reshape_q=reshape_q,\n'
                                                                                 '        '
                                                                                 'is_nope_layer=is_nope_layer,\n'
                                                                                 '        '
                                                                                 'is_vision=is_vision,\n'
                                                                                 '        '
                                                                                 'model_mode=model_mode,\n'
                                                                                 '        '
                                                                                 'base_kv_cache=base_kv_cache,\n'
                                                                                 '        '
                                                                                 'rngs=rngs,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Module '
                                                                                 'attribute '
                                                                                 'names '
                                                                                 'must '
                                                                                 'match '
                                                                                 'names '
                                                                                 'previously '
                                                                                 'passed '
                                                                                 'to '
                                                                                 'Linen '
                                                                                 'for '
                                                                                 'checkpointing\n'
                                                                                 '    '
                                                                                 'self.MlaKVCache_0 '
                                                                                 '= '
                                                                                 'self.init_mla_kv_caches(inputs_kv_shape) '
                                                                                 'if '
                                                                                 'model_mode '
                                                                                 '!= '
                                                                                 'MODEL_MODE_TRAIN '
                                                                                 'else '
                                                                                 'None\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Assert '
                                                                                 'required '
                                                                                 'configuration '
                                                                                 'parameters '
                                                                                 'for '
                                                                                 'MLA '
                                                                                 'attention.\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 '(\n'
                                                                                 '        '
                                                                                 'self.config.attention_type '
                                                                                 '== '
                                                                                 'AttentionType.MLA.value\n'
                                                                                 '    '
                                                                                 '), '
                                                                                 'f"MLA '
                                                                                 'requires '
                                                                                 'MLA '
                                                                                 'attention '
                                                                                 'type '
                                                                                 '{AttentionType.MLA.value}"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'self.kv_lora_rank '
                                                                                 '> '
                                                                                 '0, '
                                                                                 '"KV '
                                                                                 'LoRA '
                                                                                 'rank '
                                                                                 'must '
                                                                                 'be '
                                                                                 '> '
                                                                                 '0"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'self.qk_nope_head_dim '
                                                                                 '> '
                                                                                 '0, '
                                                                                 '"QK '
                                                                                 'NoPe '
                                                                                 'head '
                                                                                 'dim '
                                                                                 'must '
                                                                                 'be '
                                                                                 '> '
                                                                                 '0"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'self.qk_rope_head_dim '
                                                                                 '> '
                                                                                 '0, '
                                                                                 '"QK '
                                                                                 'RoPE '
                                                                                 'head '
                                                                                 'dim '
                                                                                 'must '
                                                                                 'be '
                                                                                 '> '
                                                                                 '0"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'self.v_head_dim '
                                                                                 '> '
                                                                                 '0, '
                                                                                 '"V '
                                                                                 'head '
                                                                                 'dim '
                                                                                 'must '
                                                                                 'be '
                                                                                 '> '
                                                                                 '0"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'self.num_query_heads '
                                                                                 '== '
                                                                                 'self.num_kv_heads, '
                                                                                 '"MLA '
                                                                                 'requires '
                                                                                 'equal '
                                                                                 'number '
                                                                                 'of '
                                                                                 'query '
                                                                                 'and '
                                                                                 'kv '
                                                                                 'heads"\n'
                                                                                 '    '
                                                                                 'assert '
                                                                                 'not '
                                                                                 'self.config.fused_qkv, '
                                                                                 '"Fused '
                                                                                 'QKV '
                                                                                 'is '
                                                                                 'not '
                                                                                 'supported '
                                                                                 'for '
                                                                                 'MLA"\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.q_lora_rank '
                                                                                 '== '
                                                                                 '0:\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'Standard '
                                                                                 'Q '
                                                                                 'projection '
                                                                                 '(without '
                                                                                 'LoRA).\n'
                                                                                 '      '
                                                                                 'self.query '
                                                                                 '= '
                                                                                 'DenseGeneral(\n'
                                                                                 '          '
                                                                                 'in_features_shape=self.config.emb_dim,\n'
                                                                                 '          '
                                                                                 'out_features_shape=(self.num_query_heads, '
                                                                                 'self.qk_head_dim),\n'
                                                                                 '          '
                                                                                 'axis=-1,\n'
                                                                                 '          '
                                                                                 'kernel_init=self.kernel_init,\n'
                                                                                 '          '
                                                                                 'kernel_axes=("embed", '
                                                                                 '"q_heads", '
                                                                                 '"kv"),\n'
                                                                                 '          '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '          '
                                                                                 'weight_dtype=self.weight_dtype,\n'
                                                                                 '          '
                                                                                 'quant=self.quant,\n'
                                                                                 '          '
                                                                                 'matmul_precision=self.config.matmul_precision,\n'
                                                                                 '          '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'LoRA '
                                                                                 'path '
                                                                                 'for '
                                                                                 'Q.\n'
                                                                                 '      '
                                                                                 'self.wq_a '
                                                                                 '= '
                                                                                 'DenseGeneral(\n'
                                                                                 '          '
                                                                                 'in_features_shape=self.config.emb_dim,\n'
                                                                                 '          '
                                                                                 'out_features_shape=self.q_lora_rank,\n'
                                                                                 '          '
                                                                                 'axis=-1,\n'
                                                                                 '          '
                                                                                 'kernel_init=self.kernel_init,\n'
                                                                                 '          '
                                                                                 'kernel_axes=("embed", '
                                                                                 '"q_lora"),\n'
                                                                                 '          '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '          '
                                                                                 'weight_dtype=self.weight_dtype,\n'
                                                                                 '          '
                                                                                 'quant=self.quant,\n'
                                                                                 '          '
                                                                                 'matmul_precision=self.config.matmul_precision,\n'
                                                                                 '          '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '      '
                                                                                 'self.q_norm '
                                                                                 '= '
                                                                                 'RMSNorm(\n'
                                                                                 '          '
                                                                                 'num_features=self.q_lora_rank,\n'
                                                                                 '          '
                                                                                 'dtype=self.config.dtype,\n'
                                                                                 '          '
                                                                                 'weight_dtype=self.config.weight_dtype,\n'
                                                                                 '          '
                                                                                 'epsilon=self.config.normalization_layer_epsilon,\n'
                                                                                 '          '
                                                                                 'kernel_axes=("norm",),\n'
                                                                                 '          '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '      '
                                                                                 'self.wq_b '
                                                                                 '= '
                                                                                 'DenseGeneral(\n'
                                                                                 '          '
                                                                                 'in_features_shape=self.q_lora_rank,\n'
                                                                                 '          '
                                                                                 'out_features_shape=(self.num_query_heads, '
                                                                                 'self.qk_head_dim),\n'
                                                                                 '          '
                                                                                 'axis=-1,\n'
                                                                                 '          '
                                                                                 'kernel_init=self.kernel_init,\n'
                                                                                 '          '
                                                                                 'kernel_axes=("q_lora", '
                                                                                 '"q_heads", '
                                                                                 '"kv"),\n'
                                                                                 '          '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '          '
                                                                                 'weight_dtype=self.weight_dtype,\n'
                                                                                 '          '
                                                                                 'quant=self.quant,\n'
                                                                                 '          '
                                                                                 'matmul_precision=self.config.matmul_precision,\n'
                                                                                 '          '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'KV '
                                                                                 'LoRA '
                                                                                 'path.\n'
                                                                                 '    '
                                                                                 'self.wkv_a '
                                                                                 '= '
                                                                                 'DenseGeneral(\n'
                                                                                 '        '
                                                                                 'in_features_shape=self.config.emb_dim,\n'
                                                                                 '        '
                                                                                 'out_features_shape=self.kv_lora_rank '
                                                                                 '+ '
                                                                                 'self.qk_rope_head_dim,\n'
                                                                                 '        '
                                                                                 'axis=-1,\n'
                                                                                 '        '
                                                                                 'kernel_init=self.kernel_init,\n'
                                                                                 '        '
                                                                                 'kernel_axes=("embed", '
                                                                                 '"kv_lora"),\n'
                                                                                 '        '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '        '
                                                                                 'weight_dtype=self.weight_dtype,\n'
                                                                                 '        '
                                                                                 'quant=self.quant,\n'
                                                                                 '        '
                                                                                 'matmul_precision=self.config.matmul_precision,\n'
                                                                                 '        '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '    '
                                                                                 'self.kv_norm '
                                                                                 '= '
                                                                                 'RMSNorm(\n'
                                                                                 '        '
                                                                                 'num_features=self.kv_lora_rank,\n'
                                                                                 '        '
                                                                                 'dtype=self.config.dtype,\n'
                                                                                 '        '
                                                                                 'weight_dtype=self.config.weight_dtype,\n'
                                                                                 '        '
                                                                                 'epsilon=self.config.normalization_layer_epsilon,\n'
                                                                                 '        '
                                                                                 'kernel_axes=("norm",),\n'
                                                                                 '        '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '    '
                                                                                 'self.wkv_b '
                                                                                 '= '
                                                                                 'DenseGeneral(\n'
                                                                                 '        '
                                                                                 'in_features_shape=self.kv_lora_rank,\n'
                                                                                 '        '
                                                                                 'out_features_shape=(\n'
                                                                                 '            '
                                                                                 'self.num_query_heads,\n'
                                                                                 '            '
                                                                                 '(self.qk_nope_head_dim '
                                                                                 '+ '
                                                                                 'self.v_head_dim),\n'
                                                                                 '        '
                                                                                 '),\n'
                                                                                 '        '
                                                                                 'axis=-1,\n'
                                                                                 '        '
                                                                                 'kernel_init=self.kernel_init,\n'
                                                                                 '        '
                                                                                 'kernel_axes=("kv_lora", '
                                                                                 '"kv_heads", '
                                                                                 '"kv_head_dim"),\n'
                                                                                 '        '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '        '
                                                                                 'weight_dtype=self.weight_dtype,\n'
                                                                                 '        '
                                                                                 'quant=self.quant,\n'
                                                                                 '        '
                                                                                 'matmul_precision=self.config.matmul_precision,\n'
                                                                                 '        '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Set '
                                                                                 'softmax '
                                                                                 'scaling.\n'
                                                                                 '    '
                                                                                 'self.softmax_scale '
                                                                                 '= '
                                                                                 'self.qk_head_dim**-0.5\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.max_position_embeddings '
                                                                                 '> '
                                                                                 'self.original_max_position_embeddings:\n'
                                                                                 '      '
                                                                                 'mscale '
                                                                                 '= '
                                                                                 '0.1 '
                                                                                 '* '
                                                                                 'self.mscale '
                                                                                 '* '
                                                                                 'jnp.log(self.rope_factor) '
                                                                                 '+ '
                                                                                 '1.0\n'
                                                                                 '      '
                                                                                 'self.softmax_scale '
                                                                                 '= '
                                                                                 'self.softmax_scale '
                                                                                 '* '
                                                                                 'mscale '
                                                                                 '* '
                                                                                 'mscale\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Setup '
                                                                                 'paged '
                                                                                 'attention '
                                                                                 'op\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.config.attention '
                                                                                 '== '
                                                                                 '"paged":\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'Set '
                                                                                 'head_dim '
                                                                                 'to '
                                                                                 'the '
                                                                                 'max '
                                                                                 'of '
                                                                                 'qk_head_dim '
                                                                                 'and '
                                                                                 'v_head_dim. '
                                                                                 'The '
                                                                                 'current '
                                                                                 'paged\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'attention '
                                                                                 'kernel '
                                                                                 'requires '
                                                                                 'the '
                                                                                 'head_dim '
                                                                                 'to '
                                                                                 'be '
                                                                                 'the '
                                                                                 'same '
                                                                                 'for '
                                                                                 'q, '
                                                                                 'k, '
                                                                                 'v.\n'
                                                                                 '      '
                                                                                 'head_dim '
                                                                                 '= '
                                                                                 'max(self.qk_head_dim, '
                                                                                 'self.v_head_dim)\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'Align '
                                                                                 'head_dim '
                                                                                 'to '
                                                                                 'the '
                                                                                 'pagedattn_head_dim_alignment '
                                                                                 'if '
                                                                                 'specified.\n'
                                                                                 '      '
                                                                                 'if '
                                                                                 'self.config.pagedattn_head_dim_alignment '
                                                                                 '> '
                                                                                 '0:\n'
                                                                                 '        '
                                                                                 'alignment '
                                                                                 '= '
                                                                                 'self.config.pagedattn_head_dim_alignment\n'
                                                                                 '        '
                                                                                 'head_dim '
                                                                                 '= '
                                                                                 '(head_dim '
                                                                                 '+ '
                                                                                 'alignment '
                                                                                 '- '
                                                                                 '1) '
                                                                                 '// '
                                                                                 'alignment '
                                                                                 '* '
                                                                                 'alignment\n'
                                                                                 '      '
                                                                                 'self.ds_paged_attention_op '
                                                                                 '= '
                                                                                 'paged_attention.PagedAttentionOp(\n'
                                                                                 '          '
                                                                                 'mesh=self.mesh,\n'
                                                                                 '          '
                                                                                 'num_pages=self.config.pagedattn_num_pages,\n'
                                                                                 '          '
                                                                                 'tokens_per_page=self.config.pagedattn_tokens_per_page,\n'
                                                                                 '          '
                                                                                 'max_pages_per_slot=(self.config.max_target_length '
                                                                                 '+ '
                                                                                 'self.config.pagedattn_tokens_per_page '
                                                                                 '- '
                                                                                 '1)\n'
                                                                                 '          '
                                                                                 '// '
                                                                                 'self.config.pagedattn_tokens_per_page,\n'
                                                                                 '          '
                                                                                 'max_pages_per_prefill=(self.config.max_prefill_predict_length '
                                                                                 '+ '
                                                                                 'self.config.pagedattn_tokens_per_page '
                                                                                 '- '
                                                                                 '1)\n'
                                                                                 '          '
                                                                                 '// '
                                                                                 'self.config.pagedattn_tokens_per_page,\n'
                                                                                 '          '
                                                                                 'pages_per_compute_block=self.config.pagedattn_pages_per_compute_block,\n'
                                                                                 '          '
                                                                                 'num_kv_heads=self.num_kv_heads,\n'
                                                                                 '          '
                                                                                 'kv_head_dim_size=head_dim,\n'
                                                                                 '          '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '          '
                                                                                 'attn_logits_soft_cap=self.attn_logits_soft_cap,\n'
                                                                                 '          '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 'mla_query_projection(self, '
                                                                                 'inputs_q: '
                                                                                 'Array, '
                                                                                 'inputs_positions: '
                                                                                 'Array, '
                                                                                 'model_mode) '
                                                                                 '-> '
                                                                                 'Array:\n'
                                                                                 '    '
                                                                                 '"""Query '
                                                                                 'projection '
                                                                                 'for '
                                                                                 'MLA, '
                                                                                 'e.g. '
                                                                                 'includes '
                                                                                 'LoRA '
                                                                                 'if '
                                                                                 'q_lora_rank '
                                                                                 '> '
                                                                                 '0."""\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Set '
                                                                                 'softmax '
                                                                                 'scaling.\n'
                                                                                 '    '
                                                                                 'self.qk_head_dim '
                                                                                 '= '
                                                                                 'self.qk_nope_head_dim '
                                                                                 '+ '
                                                                                 'self.qk_rope_head_dim\n'
                                                                                 '    '
                                                                                 'self.softmax_scale '
                                                                                 '= '
                                                                                 'self.qk_head_dim**-0.5\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.max_position_embeddings '
                                                                                 '> '
                                                                                 'self.original_max_position_embeddings:\n'
                                                                                 '      '
                                                                                 'mscale '
                                                                                 '= '
                                                                                 '0.1 '
                                                                                 '* '
                                                                                 'self.mscale '
                                                                                 '* '
                                                                                 'jnp.log(self.rope_factor) '
                                                                                 '+ '
                                                                                 '1.0\n'
                                                                                 '      '
                                                                                 'self.softmax_scale '
                                                                                 '= '
                                                                                 'self.softmax_scale '
                                                                                 '* '
                                                                                 'mscale '
                                                                                 '* '
                                                                                 'mscale\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.q_lora_rank '
                                                                                 '== '
                                                                                 '0:\n'
                                                                                 '      '
                                                                                 'q '
                                                                                 '= '
                                                                                 'self.query(inputs_q)\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 '# '
                                                                                 'LoRA '
                                                                                 'path\n'
                                                                                 '      '
                                                                                 'low_rank_q '
                                                                                 '= '
                                                                                 'self.wq_a(inputs_q)  '
                                                                                 '# '
                                                                                 '[B, '
                                                                                 'L, '
                                                                                 'q_lora_rank]\n'
                                                                                 '      '
                                                                                 'low_rank_q '
                                                                                 '= '
                                                                                 'self.q_norm(low_rank_q)  '
                                                                                 '# '
                                                                                 'RMSNorm '
                                                                                 'on '
                                                                                 'low '
                                                                                 'rank\n'
                                                                                 '      '
                                                                                 'q '
                                                                                 '= '
                                                                                 'self.wq_b(low_rank_q)  '
                                                                                 '# '
                                                                                 '[B, '
                                                                                 'L, '
                                                                                 'n_heads '
                                                                                 '* '
                                                                                 'qk_head_dim]\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Split '
                                                                                 'into '
                                                                                 'non-positional '
                                                                                 'and '
                                                                                 'rotary '
                                                                                 'parts.\n'
                                                                                 '    '
                                                                                 'q_nope, '
                                                                                 'q_pe '
                                                                                 '= '
                                                                                 'jnp.split(q, '
                                                                                 '[self.qk_nope_head_dim], '
                                                                                 'axis=-1)\n'
                                                                                 '    '
                                                                                 'q_pe '
                                                                                 '= '
                                                                                 'self.apply_rotary_embedding(q_pe, '
                                                                                 'inputs_positions=inputs_positions)\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Query '
                                                                                 'projection '
                                                                                 'is '
                                                                                 'scaled '
                                                                                 'by '
                                                                                 'self.softmax_scale '
                                                                                 'to '
                                                                                 'be '
                                                                                 'consistent '
                                                                                 'MaxText '
                                                                                 'implementation.\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'DeepSeek '
                                                                                 'v3 '
                                                                                 'was '
                                                                                 'doing '
                                                                                 'it '
                                                                                 'in '
                                                                                 'attention '
                                                                                 'score '
                                                                                 'computation.\n'
                                                                                 '    '
                                                                                 'query '
                                                                                 '= '
                                                                                 'jnp.concatenate([q_nope, '
                                                                                 'q_pe], '
                                                                                 'axis=-1) '
                                                                                 '* '
                                                                                 'self.softmax_scale\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_PREFILL:\n'
                                                                                 '      '
                                                                                 'query '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(query, '
                                                                                 'self.prefill_query_axis_names)\n'
                                                                                 '    '
                                                                                 'elif '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_TRAIN '
                                                                                 'and '
                                                                                 'self.config.expert_shard_attention_option '
                                                                                 '== '
                                                                                 'EP_AS_CONTEXT:\n'
                                                                                 '      '
                                                                                 'query '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(query, '
                                                                                 'self.ep_query_axis_names)\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'query '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(query, '
                                                                                 'self.query_axis_names)\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 'query\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 'mla_get_key_value(self, '
                                                                                 'low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'model_mode):\n'
                                                                                 '    '
                                                                                 '"""get '
                                                                                 '(key,value) '
                                                                                 'pair '
                                                                                 'from '
                                                                                 'mla"""\n'
                                                                                 '    '
                                                                                 'kv_out '
                                                                                 '= '
                                                                                 'self.wkv_b(low_rank_main)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Split '
                                                                                 'kv_out '
                                                                                 'into '
                                                                                 'key_nope '
                                                                                 'and '
                                                                                 'value '
                                                                                 'parts.\n'
                                                                                 '    '
                                                                                 'key_nope, '
                                                                                 'value '
                                                                                 '= '
                                                                                 'jnp.split(kv_out, '
                                                                                 '[self.qk_nope_head_dim], '
                                                                                 'axis=-1)\n'
                                                                                 '    '
                                                                                 'key_rope '
                                                                                 '= '
                                                                                 'jnp.broadcast_to(key_rope, '
                                                                                 '(key_nope.shape[0], '
                                                                                 'key_nope.shape[1], '
                                                                                 'self.num_query_heads, '
                                                                                 'key_rope.shape[3]))\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'key '
                                                                                 '= '
                                                                                 'jnp.concatenate([key_nope, '
                                                                                 'key_rope], '
                                                                                 'axis=-1)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_PREFILL:\n'
                                                                                 '      '
                                                                                 'key '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(key, '
                                                                                 'self.prefill_key_axis_names)\n'
                                                                                 '      '
                                                                                 'value '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(value, '
                                                                                 'self.prefill_value_axis_names)\n'
                                                                                 '    '
                                                                                 'elif '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_TRAIN '
                                                                                 'and '
                                                                                 'self.config.expert_shard_attention_option '
                                                                                 '== '
                                                                                 'EP_AS_CONTEXT:\n'
                                                                                 '      '
                                                                                 'key '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(key, '
                                                                                 'self.ep_key_axis_names)\n'
                                                                                 '      '
                                                                                 'value '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(value, '
                                                                                 'self.ep_value_axis_names)\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'key '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(key, '
                                                                                 'self.key_axis_names)\n'
                                                                                 '      '
                                                                                 'value '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(value, '
                                                                                 'self.value_axis_names)\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 'key, '
                                                                                 'value\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 'init_mla_kv_caches(self, '
                                                                                 'inputs_kv_shape: '
                                                                                 'Tuple):\n'
                                                                                 '    '
                                                                                 '"""Initializes '
                                                                                 'MlaKVCache.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Args:\n'
                                                                                 '      '
                                                                                 'inputs_kv_shape: '
                                                                                 'Key/value '
                                                                                 'inputs '
                                                                                 'shape '
                                                                                 'for '
                                                                                 'initialization.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Returns:\n'
                                                                                 '      '
                                                                                 'An '
                                                                                 'MlaKVCache '
                                                                                 'module '
                                                                                 'instance.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Raises:\n'
                                                                                 '      '
                                                                                 'ValueError: '
                                                                                 'If '
                                                                                 'the '
                                                                                 'configuration '
                                                                                 'is '
                                                                                 'invalid.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '"""\n'
                                                                                 '    '
                                                                                 'batch_size, '
                                                                                 '_, '
                                                                                 '_ '
                                                                                 '= '
                                                                                 'inputs_kv_shape\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'During '
                                                                                 'initialization, '
                                                                                 'seq_len '
                                                                                 'of '
                                                                                 'inputs_kv '
                                                                                 'is '
                                                                                 'max_target_length,\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'which '
                                                                                 'is '
                                                                                 'not '
                                                                                 'always '
                                                                                 'correct '
                                                                                 'for '
                                                                                 'some '
                                                                                 'functions '
                                                                                 'in '
                                                                                 'MlaKVCache.\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'However, '
                                                                                 'MlaKVCache '
                                                                                 'internal '
                                                                                 'cache '
                                                                                 'shapes '
                                                                                 'are '
                                                                                 'based '
                                                                                 'on '
                                                                                 'max_prefill_length\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'and '
                                                                                 'max_target_length, '
                                                                                 'not '
                                                                                 'the '
                                                                                 'passed '
                                                                                 'seq_len.\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'We '
                                                                                 'can '
                                                                                 'use '
                                                                                 'a '
                                                                                 'placeholder '
                                                                                 'value. '
                                                                                 'The '
                                                                                 'correct '
                                                                                 'fix '
                                                                                 'might '
                                                                                 'involve '
                                                                                 'refactoring\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'MlaKVCache.\n'
                                                                                 '    '
                                                                                 'placeholder_seq_len '
                                                                                 '= '
                                                                                 '1\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 'kvcache.MlaKVCache(\n'
                                                                                 '        '
                                                                                 'max_prefill_length=self.max_prefill_predict_length,\n'
                                                                                 '        '
                                                                                 'max_target_length=self.max_target_length,\n'
                                                                                 '        '
                                                                                 'batch=batch_size,\n'
                                                                                 '        '
                                                                                 'key_seq_len=placeholder_seq_len,\n'
                                                                                 '        '
                                                                                 'value_seq_len=placeholder_seq_len,\n'
                                                                                 '        '
                                                                                 'key_head_size=self.kv_lora_rank,\n'
                                                                                 '        '
                                                                                 'value_head_size=self.qk_rope_head_dim,\n'
                                                                                 '        '
                                                                                 'dtype=self.dtype,\n'
                                                                                 '        '
                                                                                 'kv_quant=self.kv_quant,\n'
                                                                                 '        '
                                                                                 'prefill_cache_axis_order=self.prefill_cache_axis_order,\n'
                                                                                 '        '
                                                                                 'ar_cache_axis_order=self.ar_cache_axis_order,\n'
                                                                                 '        '
                                                                                 'model_mode=self.model_mode,\n'
                                                                                 '        '
                                                                                 'use_chunked_prefill=self.config.use_chunked_prefill,\n'
                                                                                 '        '
                                                                                 'rngs=self.rngs,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 'update_mla_kv_caches(self, '
                                                                                 'low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk=None):\n'
                                                                                 '    '
                                                                                 '"""Updates '
                                                                                 'the '
                                                                                 'MLA '
                                                                                 '(Multi-Head '
                                                                                 'Latent '
                                                                                 'Attention) '
                                                                                 'KV '
                                                                                 'caches.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'This '
                                                                                 'method '
                                                                                 'is '
                                                                                 'specific '
                                                                                 'to '
                                                                                 'the '
                                                                                 'MLA '
                                                                                 'attention '
                                                                                 'mechanism. '
                                                                                 'It '
                                                                                 'calls '
                                                                                 'the\n'
                                                                                 '    '
                                                                                 '`mla_kv_cache_as_linen` '
                                                                                 'module '
                                                                                 'to '
                                                                                 'update '
                                                                                 'and '
                                                                                 'retrieve '
                                                                                 'the '
                                                                                 'caches, '
                                                                                 'which\n'
                                                                                 '    '
                                                                                 'store '
                                                                                 'latent '
                                                                                 'representations '
                                                                                 '(`low_rank_main`) '
                                                                                 'and '
                                                                                 'RoPE-applied '
                                                                                 'keys\n'
                                                                                 '    '
                                                                                 '(`key_rope`). '
                                                                                 'It '
                                                                                 'then '
                                                                                 'reconstructs '
                                                                                 'the '
                                                                                 'full '
                                                                                 'key '
                                                                                 'and '
                                                                                 'value '
                                                                                 'tensors '
                                                                                 'from\n'
                                                                                 '    '
                                                                                 'the '
                                                                                 'cached '
                                                                                 'components.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Args:\n'
                                                                                 '      '
                                                                                 'low_rank_main: '
                                                                                 'The '
                                                                                 'main '
                                                                                 'latent '
                                                                                 'component '
                                                                                 'of '
                                                                                 'the '
                                                                                 'key.\n'
                                                                                 '      '
                                                                                 'key_rope: '
                                                                                 'The '
                                                                                 'RoPE-applied '
                                                                                 'component '
                                                                                 'of '
                                                                                 'the '
                                                                                 'key.\n'
                                                                                 '      '
                                                                                 'decoder_segment_ids: '
                                                                                 'Segment '
                                                                                 'IDs '
                                                                                 'for '
                                                                                 'decoder '
                                                                                 'masking.\n'
                                                                                 '      '
                                                                                 'model_mode: '
                                                                                 'The '
                                                                                 'operational '
                                                                                 'mode '
                                                                                 "('train', "
                                                                                 "'prefill', "
                                                                                 "'autoregressive').\n"
                                                                                 '      '
                                                                                 'previous_chunk: '
                                                                                 'Information '
                                                                                 'about '
                                                                                 'previously '
                                                                                 'processed '
                                                                                 'chunks, '
                                                                                 'for\n'
                                                                                 '        '
                                                                                 'chunked '
                                                                                 'prefill.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Returns:\n'
                                                                                 '      '
                                                                                 'A '
                                                                                 'list '
                                                                                 'containing '
                                                                                 'two '
                                                                                 'elements:\n'
                                                                                 '      '
                                                                                 '- '
                                                                                 'The '
                                                                                 'prefill '
                                                                                 'key-value '
                                                                                 'cache, '
                                                                                 'reconstructed '
                                                                                 'from '
                                                                                 'the '
                                                                                 'MLA '
                                                                                 'cache, '
                                                                                 'or '
                                                                                 'None.\n'
                                                                                 '      '
                                                                                 '- '
                                                                                 'The '
                                                                                 'autoregressive '
                                                                                 'key-value '
                                                                                 'cache, '
                                                                                 'reconstructed '
                                                                                 'from '
                                                                                 'the '
                                                                                 'MLA '
                                                                                 'cache, '
                                                                                 'or '
                                                                                 'None.\n'
                                                                                 '    '
                                                                                 '"""\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'prefill_mla_cache, '
                                                                                 'ar_mla_cache '
                                                                                 '= '
                                                                                 'self.MlaKVCache_0(\n'
                                                                                 '        '
                                                                                 'key_latent=low_rank_main,\n'
                                                                                 '        '
                                                                                 'key_rope=key_rope,\n'
                                                                                 '        '
                                                                                 'decoder_segment_ids=decoder_segment_ids,\n'
                                                                                 '        '
                                                                                 'model_mode=model_mode,\n'
                                                                                 '        '
                                                                                 'use_ragged_attention=self.use_ragged_attention,\n'
                                                                                 '        '
                                                                                 'previous_chunk=previous_chunk,\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'prefill_mla_cache:\n'
                                                                                 '      '
                                                                                 'low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'decoder_segment_ids '
                                                                                 '= '
                                                                                 'prefill_mla_cache\n'
                                                                                 '      '
                                                                                 'key, '
                                                                                 'value '
                                                                                 '= '
                                                                                 'self.mla_get_key_value(low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'model_mode)\n'
                                                                                 '      '
                                                                                 'prefill_kv_cache '
                                                                                 '= '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'decoder_segment_ids\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'prefill_kv_cache '
                                                                                 '= '
                                                                                 'None\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'ar_mla_cache:\n'
                                                                                 '      '
                                                                                 'low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'decoder_segment_ids, '
                                                                                 'lengths '
                                                                                 '= '
                                                                                 'ar_mla_cache\n'
                                                                                 '      '
                                                                                 'key, '
                                                                                 'value '
                                                                                 '= '
                                                                                 'self.mla_get_key_value(low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'model_mode)\n'
                                                                                 '      '
                                                                                 'ar_kv_cache '
                                                                                 '= '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'decoder_segment_ids, '
                                                                                 'lengths\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'ar_kv_cache '
                                                                                 '= '
                                                                                 'None\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 '[prefill_kv_cache, '
                                                                                 'ar_kv_cache]\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 'mla_kv_projection(self, '
                                                                                 'inputs: '
                                                                                 'Array, '
                                                                                 'inputs_positions: '
                                                                                 'Array, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk):\n'
                                                                                 '    '
                                                                                 '"""MLA '
                                                                                 'key/value '
                                                                                 'projection '
                                                                                 'with '
                                                                                 'integrated '
                                                                                 'rotary '
                                                                                 'embedding."""\n'
                                                                                 '    '
                                                                                 'low_rank '
                                                                                 '= '
                                                                                 'self.wkv_a(inputs)\n'
                                                                                 '    '
                                                                                 'low_rank_main, '
                                                                                 'low_rank_rope '
                                                                                 '= '
                                                                                 'jnp.split(low_rank, '
                                                                                 '[self.kv_lora_rank], '
                                                                                 'axis=-1)\n'
                                                                                 '    '
                                                                                 'low_rank_main '
                                                                                 '= '
                                                                                 'self.kv_norm(low_rank_main)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 '# '
                                                                                 'Apply '
                                                                                 'rotary '
                                                                                 'embedding '
                                                                                 'to '
                                                                                 'key_rope.\n'
                                                                                 '    '
                                                                                 'key_rope '
                                                                                 '= '
                                                                                 'jnp.expand_dims(low_rank_rope, '
                                                                                 'axis=2)\n'
                                                                                 '    '
                                                                                 'key_rope '
                                                                                 '= '
                                                                                 'self.apply_rotary_embedding(key_rope, '
                                                                                 'inputs_positions=inputs_positions)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'key, '
                                                                                 'value '
                                                                                 '= '
                                                                                 'self.mla_get_key_value(low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'model_mode)\n'
                                                                                 '    '
                                                                                 'cached_values '
                                                                                 '= '
                                                                                 '[None, '
                                                                                 'None]\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.config.attention '
                                                                                 '!= '
                                                                                 '"paged" '
                                                                                 'and '
                                                                                 'model_mode '
                                                                                 '!= '
                                                                                 'MODEL_MODE_TRAIN:\n'
                                                                                 '      '
                                                                                 'if '
                                                                                 'self.config.mla_naive_kvcache:\n'
                                                                                 '        '
                                                                                 'cached_values '
                                                                                 '= '
                                                                                 'self.update_kv_caches(key, '
                                                                                 'value, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk)\n'
                                                                                 '      '
                                                                                 'else:\n'
                                                                                 '        '
                                                                                 'cached_values '
                                                                                 '= '
                                                                                 'self.update_mla_kv_caches(\n'
                                                                                 '            '
                                                                                 'low_rank_main, '
                                                                                 'key_rope, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk\n'
                                                                                 '        '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'cached_values\n'
                                                                                 '\n'
                                                                                 '  '
                                                                                 'def '
                                                                                 '__call__(\n'
                                                                                 '      '
                                                                                 'self,\n'
                                                                                 '      '
                                                                                 'inputs_q: '
                                                                                 'Array,\n'
                                                                                 '      '
                                                                                 'inputs_kv: '
                                                                                 'Array,\n'
                                                                                 '      '
                                                                                 'inputs_positions: '
                                                                                 'Array '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'decoder_segment_ids: '
                                                                                 'Array '
                                                                                 '| '
                                                                                 'None '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 '*,\n'
                                                                                 '      '
                                                                                 'model_mode: '
                                                                                 'str '
                                                                                 '= '
                                                                                 'MODEL_MODE_TRAIN,\n'
                                                                                 '      '
                                                                                 'deterministic: '
                                                                                 'bool '
                                                                                 '= '
                                                                                 'False,\n'
                                                                                 '      '
                                                                                 'previous_chunk: '
                                                                                 'Any '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'slot: '
                                                                                 'Optional[int] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'page_state: '
                                                                                 'Optional[page_manager.PageState] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '      '
                                                                                 'bidirectional_mask: '
                                                                                 'Optional[Any] '
                                                                                 '= '
                                                                                 'None,\n'
                                                                                 '  '
                                                                                 ') '
                                                                                 '-> '
                                                                                 'Array:\n'
                                                                                 '    '
                                                                                 '"""Forward '
                                                                                 'pass '
                                                                                 'for '
                                                                                 'MLA, '
                                                                                 'reusing '
                                                                                 '`AttentionOp` '
                                                                                 'for '
                                                                                 'the '
                                                                                 'actual '
                                                                                 'attention.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Args:\n'
                                                                                 '      '
                                                                                 'inputs_q: '
                                                                                 'Query '
                                                                                 'input '
                                                                                 '[batch, '
                                                                                 'q_length, '
                                                                                 'embed_dim].\n'
                                                                                 '      '
                                                                                 'inputs_kv: '
                                                                                 'KV '
                                                                                 'input   '
                                                                                 '[batch, '
                                                                                 'kv_length, '
                                                                                 'embed_dim].\n'
                                                                                 '      '
                                                                                 'inputs_positions: '
                                                                                 'Positions '
                                                                                 'for '
                                                                                 'rotary '
                                                                                 'embeddings '
                                                                                 'or '
                                                                                 'similar.\n'
                                                                                 '      '
                                                                                 'decoder_segment_ids: '
                                                                                 'Segment '
                                                                                 'IDs '
                                                                                 'for '
                                                                                 'masking, '
                                                                                 'if '
                                                                                 'any.\n'
                                                                                 '      '
                                                                                 'model_mode: '
                                                                                 '"train", '
                                                                                 '"prefill", '
                                                                                 'or '
                                                                                 '"autoregressive".\n'
                                                                                 '      '
                                                                                 'deterministic: '
                                                                                 'Disables '
                                                                                 'dropout '
                                                                                 'if '
                                                                                 'set '
                                                                                 'to '
                                                                                 'True.\n'
                                                                                 '      '
                                                                                 'previous_chunk: '
                                                                                 'Information '
                                                                                 'about '
                                                                                 'previously '
                                                                                 'processed '
                                                                                 'chunks '
                                                                                 'for '
                                                                                 'chunked '
                                                                                 'prefill.\n'
                                                                                 '      '
                                                                                 'slot: '
                                                                                 'The '
                                                                                 'batch '
                                                                                 'slot '
                                                                                 'index '
                                                                                 'for '
                                                                                 'paged '
                                                                                 'attention.\n'
                                                                                 '      '
                                                                                 'page_state: '
                                                                                 'The '
                                                                                 'current '
                                                                                 'state '
                                                                                 'of '
                                                                                 'the '
                                                                                 'paged '
                                                                                 'attention '
                                                                                 'manager.\n'
                                                                                 '      '
                                                                                 'bidirectional_mask: '
                                                                                 'A '
                                                                                 'mask '
                                                                                 'for '
                                                                                 'bidirectional '
                                                                                 'attention, '
                                                                                 'used '
                                                                                 'in '
                                                                                 'multimodal '
                                                                                 'models.\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'Returns:\n'
                                                                                 '      '
                                                                                 'A '
                                                                                 'tensor '
                                                                                 'of '
                                                                                 'shape '
                                                                                 '[batch, '
                                                                                 'length, '
                                                                                 'embed_dim] '
                                                                                 'containing '
                                                                                 'the\n'
                                                                                 '      '
                                                                                 'MLA-attended '
                                                                                 'outputs.\n'
                                                                                 '    '
                                                                                 '"""\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_PREFILL:\n'
                                                                                 '      '
                                                                                 'inputs_q '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_q, '
                                                                                 'self.prefill_input_axis_names)\n'
                                                                                 '      '
                                                                                 'inputs_kv '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_kv, '
                                                                                 'self.prefill_input_axis_names)\n'
                                                                                 '    '
                                                                                 'elif '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_TRAIN '
                                                                                 'and '
                                                                                 'self.config.expert_shard_attention_option '
                                                                                 '== '
                                                                                 'EP_AS_CONTEXT:\n'
                                                                                 '      '
                                                                                 'inputs_q '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_q, '
                                                                                 'self.ep_input_axis_names)\n'
                                                                                 '      '
                                                                                 'inputs_kv '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_kv, '
                                                                                 'self.ep_input_axis_names)\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'inputs_q '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_q, '
                                                                                 'self.input_axis_names)\n'
                                                                                 '      '
                                                                                 'inputs_kv '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(inputs_kv, '
                                                                                 'self.input_axis_names)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'query '
                                                                                 '= '
                                                                                 'self.mla_query_projection(inputs_q, '
                                                                                 'inputs_positions, '
                                                                                 'model_mode)\n'
                                                                                 '    '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'cached_values '
                                                                                 '= '
                                                                                 'self.mla_kv_projection(\n'
                                                                                 '        '
                                                                                 'inputs_kv, '
                                                                                 'inputs_positions, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk\n'
                                                                                 '    '
                                                                                 ')\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'query '
                                                                                 '= '
                                                                                 'checkpoint_name(query, '
                                                                                 '"query_proj")\n'
                                                                                 '    '
                                                                                 'key '
                                                                                 '= '
                                                                                 'checkpoint_name(key, '
                                                                                 '"key_proj")\n'
                                                                                 '    '
                                                                                 'value '
                                                                                 '= '
                                                                                 'checkpoint_name(value, '
                                                                                 '"value_proj")\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'self.config.attention '
                                                                                 '== '
                                                                                 '"paged" '
                                                                                 'and '
                                                                                 'model_mode '
                                                                                 '!= '
                                                                                 'MODEL_MODE_TRAIN:\n'
                                                                                 '      '
                                                                                 'unnormalized_out, '
                                                                                 '_, '
                                                                                 'exp_sum '
                                                                                 '= '
                                                                                 'self.ds_paged_attention_op(\n'
                                                                                 '          '
                                                                                 'query, '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'previous_chunk, '
                                                                                 'slot=slot, '
                                                                                 'page_state=page_state\n'
                                                                                 '      '
                                                                                 ')\n'
                                                                                 '      '
                                                                                 'unnormalized_out '
                                                                                 '= '
                                                                                 'unnormalized_out[..., '
                                                                                 ': '
                                                                                 'self.v_head_dim]\n'
                                                                                 '      '
                                                                                 'out '
                                                                                 '= '
                                                                                 'unnormalized_out '
                                                                                 '/ '
                                                                                 '(exp_sum '
                                                                                 '+ '
                                                                                 '1e-9) '
                                                                                 'if '
                                                                                 'exp_sum '
                                                                                 'is '
                                                                                 'not '
                                                                                 'None '
                                                                                 'else '
                                                                                 'unnormalized_out\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'out '
                                                                                 '= '
                                                                                 'self.attention_op(query, '
                                                                                 'key, '
                                                                                 'value, '
                                                                                 'decoder_segment_ids, '
                                                                                 'model_mode, '
                                                                                 'cached_values)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'if '
                                                                                 'model_mode '
                                                                                 '== '
                                                                                 'MODEL_MODE_TRAIN '
                                                                                 'and '
                                                                                 'self.config.expert_shard_attention_option '
                                                                                 '== '
                                                                                 'EP_AS_CONTEXT:\n'
                                                                                 '      '
                                                                                 'out '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(out, '
                                                                                 'self.ep_out_axis_names)\n'
                                                                                 '    '
                                                                                 'else:\n'
                                                                                 '      '
                                                                                 'out '
                                                                                 '= '
                                                                                 'nn.with_logical_constraint(out, '
                                                                                 'self.out_axis_names)\n'
                                                                                 '\n'
                                                                                 '    '
                                                                                 'out '
                                                                                 '= '
                                                                                 'self.out_projection(out)\n'
                                                                                 '    '
                                                                                 'return '
                                                                                 'out'],
                                                                                [0.0,
                                                                                 'MaxText/layers/attention_op.py#validate_compute_axis_order',
                                                                                 'MaxText/layers/attention_op.py',
                                                                                 'def '
                                                                                 'validate_compute_axis_order(s: '
                                                                                 'AxisIdxes) '
                                                                                 '-> '
                                                                                 'None:\n'
                                                                                 '  '
                                                                                 'valid_compute_axis_order '
                                                                                 '= '
                                                                                 '((0, '
                                                                                 '1, '
                                                                                 '2, '
                                                                                 '3), '
                                                                                 '(0, '
                                                                                 '2, '
                                                                                 '1, '
                                                                                 '3))\n'
                                                                                 '  '
                                                                                 'if '
                                                                                 's '
                                                                                 'not '
                                                                                 'in '
                                                                                 'valid_compute_axis_order:  '
                                                                                 '# '
                                                                                 'currently '
                                                                                 'supported '
                                                                                 'compute_axis_order\n'
                                                                                 '    '
                                                                                 'raise '
                                                                                 'ValueError("Invalid '
                                                                                 'compute_axis_order '
                                                                                 'was '
                                                                                 'passed. '
                                                                                 'Valid '
                                                                                 'options '
                                                                                 '", '
                                                                                 'valid_compute_axis_order)']]},
  'comp_id': 'transformers/utils/import_utils.py#BACKENDS_MAPPING',
  'comp_name': 'BACKENDS_MAPPING',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#BACKENDS_MAPPING',
                   'transformers/utils/import_utils.py#VersionComparison',
                   'transformers/utils/import_utils.py#split_package_version'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#Backend',
  'comp_name': 'Backend',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#BACKENDS_MAPPING',
                   'transformers/utils/import_utils.py#Backend'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#requires',
  'comp_name': 'requires',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#requires'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/generic.py#OutputRecorder',
  'comp_name': 'OutputRecorder',
  'filepath': 'transformers/utils/generic.py'},
 {'Dependencies': ['transformers/utils/import_utils.py#BACKENDS_MAPPING',
                   'transformers/utils/import_utils.py#Backend',
                   'transformers/utils/import_utils.py#PYTORCH_IMPORT_ERROR_WITH_TF',
                   'transformers/utils/import_utils.py#TF_IMPORT_ERROR_WITH_PYTORCH',
                   'transformers/utils/import_utils.py#is_tf_available',
                   'transformers/utils/import_utils.py#is_torch_available'],
  'JaxDependencies': {},
  'comp_id': 'transformers/utils/import_utils.py#requires_backends',
  'comp_name': 'requires_backends',
  'filepath': 'transformers/utils/import_utils.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou',
                   'transformers/utils/import_utils.py#requires_backends'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_rt_detr.py#RTDetrHungarianMatcher',
  'comp_name': 'RTDetrHungarianMatcher',
  'filepath': 'transformers/loss/loss_rt_detr.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#box_iou',
                   'transformers/loss/loss_for_object_detection.py#dice_loss',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou',
                   'transformers/loss/loss_for_object_detection.py#nested_tensor_from_tensor_list',
                   'transformers/loss/loss_for_object_detection.py#sigmoid_focal_loss',
                   'transformers/loss/loss_rt_detr.py#RTDetrHungarianMatcher'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_rt_detr.py#RTDetrLoss',
  'comp_name': 'RTDetrLoss',
  'filepath': 'transformers/loss/loss_rt_detr.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_d_fine.py#bbox2distance',
                   'transformers/loss/loss_for_object_detection.py#box_iou',
                   'transformers/loss/loss_rt_detr.py#RTDetrHungarianMatcher',
                   'transformers/loss/loss_rt_detr.py#RTDetrLoss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#DFineLoss',
  'comp_name': 'DFineLoss',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': ['transformers/loss/loss_d_fine.py#DFineLoss',
                   'transformers/loss/loss_d_fine.py#_set_aux_loss',
                   'transformers/loss/loss_d_fine.py#_set_aux_loss2'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_d_fine.py#DFineForObjectDetectionLoss',
  'comp_name': 'DFineForObjectDetectionLoss',
  'filepath': 'transformers/loss/loss_d_fine.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou',
                   'transformers/utils/import_utils.py#requires_backends'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#HungarianMatcher',
  'comp_name': 'HungarianMatcher',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#HungarianMatcher',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_deformable_detr.py#DeformableDetrHungarianMatcher',
  'comp_name': 'DeformableDetrHungarianMatcher',
  'filepath': 'transformers/loss/loss_deformable_detr.py'},
 {'Dependencies': ['transformers/loss/loss_deformable_detr.py#DeformableDetrHungarianMatcher',
                   'transformers/loss/loss_deformable_detr.py#DeformableDetrImageLoss',
                   'transformers/loss/loss_for_object_detection.py#_set_aux_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_deformable_detr.py#DeformableDetrForObjectDetectionLoss',
  'comp_name': 'DeformableDetrForObjectDetectionLoss',
  'filepath': 'transformers/loss/loss_deformable_detr.py'},
 {'Dependencies': ['transformers/loss/loss_deformable_detr.py#DeformableDetrImageLoss',
                   'transformers/loss/loss_for_object_detection.py#HungarianMatcher',
                   'transformers/loss/loss_for_object_detection.py#_set_aux_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_deformable_detr.py#DeformableDetrForSegmentationLoss',
  'comp_name': 'DeformableDetrForSegmentationLoss',
  'filepath': 'transformers/loss/loss_deformable_detr.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#HungarianMatcher',
                   'transformers/loss/loss_for_object_detection.py#ImageLoss',
                   'transformers/loss/loss_for_object_detection.py#_set_aux_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#ForObjectDetectionLoss',
  'comp_name': 'ForObjectDetectionLoss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#HungarianMatcher',
                   'transformers/loss/loss_for_object_detection.py#ImageLoss',
                   'transformers/loss/loss_for_object_detection.py#_set_aux_loss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_for_object_detection.py#ForSegmentationLoss',
  'comp_name': 'ForSegmentationLoss',
  'filepath': 'transformers/loss/loss_for_object_detection.py'},
 {'Dependencies': ['transformers/image_transforms.py#center_to_corners_format',
                   'transformers/loss/loss_for_object_detection.py#HungarianMatcher',
                   'transformers/loss/loss_for_object_detection.py#generalized_box_iou'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_grounding_dino.py#GroundingDinoHungarianMatcher',
  'comp_name': 'GroundingDinoHungarianMatcher',
  'filepath': 'transformers/loss/loss_grounding_dino.py'},
 {'Dependencies': ['transformers/loss/loss_for_object_detection.py#_set_aux_loss',
                   'transformers/loss/loss_grounding_dino.py#GroundingDinoHungarianMatcher',
                   'transformers/loss/loss_grounding_dino.py#GroundingDinoImageLoss'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_grounding_dino.py#GroundingDinoForObjectDetectionLoss',
  'comp_name': 'GroundingDinoForObjectDetectionLoss',
  'filepath': 'transformers/loss/loss_grounding_dino.py'},
 {'Dependencies': ['transformers/loss/loss_d_fine.py#DFineForObjectDetectionLoss',
                   'transformers/loss/loss_deformable_detr.py#DeformableDetrForObjectDetectionLoss',
                   'transformers/loss/loss_deformable_detr.py#DeformableDetrForSegmentationLoss',
                   'transformers/loss/loss_for_object_detection.py#ForObjectDetectionLoss',
                   'transformers/loss/loss_for_object_detection.py#ForSegmentationLoss',
                   'transformers/loss/loss_grounding_dino.py#GroundingDinoForObjectDetectionLoss',
                   'transformers/loss/loss_rt_detr.py#RTDetrForObjectDetectionLoss',
                   'transformers/loss/loss_utils.py#ForCausalLMLoss',
                   'transformers/loss/loss_utils.py#ForMaskedLMLoss',
                   'transformers/loss/loss_utils.py#ForQuestionAnsweringLoss',
                   'transformers/loss/loss_utils.py#ForSequenceClassificationLoss',
                   'transformers/loss/loss_utils.py#ForTokenClassification'],
  'JaxDependencies': {},
  'comp_id': 'transformers/loss/loss_utils.py#LOSS_MAPPING',
  'comp_name': 'LOSS_MAPPING',
  'filepath': 'transformers/loss/loss_utils.py'},
 {'Dependencies': ['transformers/configuration_utils.py#PretrainedConfig',
                   'transformers/loss/loss_utils.py#LOSS_MAPPING',
                   'transformers/modeling_flash_attention_utils.py#lazy_import_flash_attention',
                   'transformers/modeling_utils.py#EmbeddingAccessMixin',
                   'transformers/modeling_utils.py#ModuleUtilsMixin',
                   'transformers/modeling_utils.py#SpecificPreTrainedModelType',
                   'transformers/modeling_utils.py#_get_tied_weight_keys',
                   'transformers/modeling_utils.py#_init_weights',
                   'transformers/modeling_utils.py#logger',
                   'transformers/modeling_utils.py#no_init_weights',
                   'transformers/modeling_utils.py#restore_default_dtype',
                   'transformers/quantizers/quantizers_utils.py#get_module_from_name',
                   'transformers/utils/generic.py#ContextManagers',
                   'transformers/utils/generic.py#OutputRecorder',
                   'transformers/utils/generic.py#_CAN_RECORD_REGISTRY',
                   'transformers/utils/import_utils.py#is_flash_attn_2_available',
                   'transformers/utils/import_utils.py#is_flash_attn_3_available',
                   'transformers/utils/import_utils.py#is_torch_flex_attn_available',
                   'transformers/utils/import_utils.py#is_torch_mlu_available',
                   'transformers/utils/import_utils.py#is_torch_npu_available',
                   'transformers/utils/logging.py#logging.WARNING'],
  'JaxDependencies': {},
  'comp_id': 'transformers/modeling_utils.py#PreTrainedModel',
  'comp_name': 'PreTrainedModel',
  'filepath': 'transformers/modeling_utils.py'},
 {'Dependencies': ['transformers/modeling_utils.py#PreTrainedModel',
                   'transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeAttention',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeDecoderLayer',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeSparseMoeBlock'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoePreTrainedModel',
  'comp_name': 'Qwen3MoePreTrainedModel',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/masking_utils.py#create_causal_mask',
                   'transformers/masking_utils.py#create_sliding_window_causal_mask',
                   'transformers/modeling_outputs.py#MoeModelOutputWithPast',
                   'transformers/models/qwen3_moe/configuration_qwen3_moe.py#Qwen3MoeConfig',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeDecoderLayer',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoePreTrainedModel',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRMSNorm',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeRotaryEmbedding'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeModel',
  'comp_name': 'Qwen3MoeModel',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'},
 {'Dependencies': ['transformers/cache_utils.py#Cache',
                   'transformers/modeling_outputs.py#MoeCausalLMOutputWithPast',
                   'transformers/modeling_outputs.py#MoeModelOutputWithPast',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeModel',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoePreTrainedModel',
                   'transformers/models/qwen3_moe/modeling_qwen3_moe.py#load_balancing_loss_func'],
  'JaxDependencies': {},
  'comp_id': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py#Qwen3MoeForCausalLM',
  'comp_name': 'Qwen3MoeForCausalLM',
  'filepath': 'transformers/models/qwen3_moe/modeling_qwen3_moe.py'}]
